# é‡åŒ–åˆ†æå¸ˆä¸æ¨¡å‹è®­ç»ƒç®¡ç†è®¾è®¡æ–¹æ¡ˆ

> ç‰ˆæœ¬ï¼šv0.1 è®¾è®¡åˆç¨¿  
> å…³è”æ–‡æ¡£ï¼š`docs/quant_model_evaluation.md`

---

## 1. èƒŒæ™¯ä¸ç›®æ ‡

æœ¬è®¾è®¡æ–¹æ¡ˆåœ¨ã€Šé‡åŒ–æ¨¡å‹è¯„ä¼°æŠ¥å‘Šã€‹çš„åŸºç¡€ä¸Šï¼Œç»™å‡ºå¯ä»¥åœ¨å½“å‰ç³»ç»Ÿä¸­è½åœ°çš„ã€**ä¸ç²¾ç®€**çš„å®Œæ•´å®ç°æ€è·¯ï¼Œè¦†ç›–ï¼š

- é‡åŒ–åˆ†æå¸ˆï¼ˆQuant Analystï¼‰ä¸ç»Ÿä¸€ `Signal` é€‚é…å±‚çš„åŠŸèƒ½ä¸æ¥å£ï¼›
- ç¬¬ä¸€å±‚ä¸ç¬¬äºŒå±‚æ¨¡å‹ï¼ˆARIMA/HMM/LSTM/DeepARï¼‰çš„æ¥å…¥æ–¹å¼ï¼Œé‡ç‚¹æ˜¯ LSTM ä¸ DeepARï¼›
- LSTM/DeepAR çš„è®­ç»ƒå¯¹è±¡èŒƒå›´ã€æ•°æ®ç²’åº¦ã€å†å²é•¿åº¦ã€è®­ç»ƒé¢‘ç‡ã€æ—¶é—´é¢„ç®—ç­‰å…·ä½“é…ç½®ï¼›
- LSTM ä½¿ç”¨ Tick/ç›˜å£çº§æ•°æ®ç»èšåˆåçš„é«˜é¢‘ç‰¹å¾å®ç°æ–¹æ¡ˆï¼›
- DeepAR ä½¿ç”¨çš„æ—¥çº§å› å­ï¼ˆå«ä»é«˜é¢‘èšåˆæ¥çš„æ—¥çº§å› å­ï¼‰è®¾è®¡ï¼›
- æ¨¡å‹è®­ç»ƒç®¡ç†æ¨¡å—ï¼š
  - åˆå§‹è®­ç»ƒä¸é‡è®­ä»»åŠ¡é…ç½®ï¼›
  - è‡ªå®šä¹‰è®­ç»ƒèŒƒå›´ã€æ—¶é—´è·¨åº¦ä¸æ•°æ®ç²’åº¦ï¼›
  - è‡ªåŠ¨æ¨ç†è°ƒåº¦ï¼ˆæ¯å¤© / æ¯ 5â€“15 åˆ†é’Ÿï¼‰ä¸æ‰‹å·¥è§¦å‘æ¥å£ï¼›
  - æ¨¡å‹è®­ç»ƒå…ƒä¿¡æ¯çš„è®°å½•ä¸å±•ç¤ºï¼›
- æœ¬åœ°æ•°æ®ç®¡ç†ï¼šåœ¨ TimescaleDB ä¸­å¯¹å†å²æ•°æ®çš„åˆå§‹åŒ–ä¸å¢é‡åŒæ­¥ï¼Œæ”¯æŒç²¾ç¡®åˆ°ä¸ªè‚¡/äº¤æ˜“æ‰€/æ—¶é—´èŒƒå›´çš„æ§åˆ¶ï¼Œä»¥åŠå®šæ—¶ä»»åŠ¡è°ƒåº¦ã€‚

è¯¥æ–¹æ¡ˆç›®æ ‡æ˜¯ä½œä¸ºåç»­å¼€å‘ä¸è¿ç»´çš„**æ‰§è¡Œè“æœ¬**ï¼š

- æ¯ä¸ªé˜¶æ®µçš„å®ç°æ­¥éª¤åœ¨æœ¬æ–¹æ¡ˆæœ«å°¾æœ‰æ˜ç¡®åˆ—å‡ºï¼›
- æ¯æ¬¡æ‰§è¡Œå®Œå…·ä½“æ­¥éª¤ï¼Œéœ€è¦åœ¨æœ¬æ–¹æ¡ˆä¸­æ›´æ–°å¯¹åº”æ¡ç›®çš„è¿›åº¦çŠ¶æ€ï¼Œä¾¿äºé•¿æœŸè·Ÿè¸ªã€‚

---

## 2. æ€»ä½“æ¶æ„æ¦‚è§ˆ

### 2.1 åˆ†å±‚ç»“æ„

æ•´ä½“æŒ‰äº”å±‚åˆ’åˆ†ï¼š

1. **æ•°æ®å±‚ï¼ˆData Layerï¼‰**
   - æ•°æ®æºï¼š
     - TDX APIï¼šæ—¥ Kã€å¤šå‘¨æœŸåˆ†é’Ÿ Kã€é€ç¬”æˆäº¤ã€äº”æ¡£ç›˜å£ç­‰ï¼›
     - ç°æœ‰ç³»ç»Ÿå†…ç”Ÿæ•°æ®ï¼šèµ„é‡‘ã€ç­¹ç ã€æƒ…ç»ªã€åŸºæœ¬é¢ã€é£é™©äº‹ä»¶ç­‰ã€‚
   - æœ¬åœ°å­˜å‚¨ï¼š
     - å¤ç”¨ç°æœ‰ **TimescaleDB**ï¼Œåœ¨åŸæœ‰ schema ä¸‹æ–°å¢ä¸“ç”¨æ—¶åºè¡¨ï¼ˆhypertableï¼‰ã€‚
     - æ•°æ®åº“è¿æ¥å‚æ•°ä» `.env` ä¸­è¯»å–ï¼ˆå¦‚ `DATABASE_URL` / `TIMESCALE_URL`ï¼‰ã€‚

2. **ç‰¹å¾å±‚ï¼ˆFeature Layerï¼‰**
   - å°†åŸå§‹è¡Œæƒ…ã€æˆäº¤ã€èµ„é‡‘ç­‰æ•°æ®è½¬ä¸ºæ¨¡å‹è¾“å…¥ç‰¹å¾ï¼š
     - æ—¥çº§ã€å¤šå‘¨æœŸåˆ†é’Ÿçº§ K çº¿ä¸æŠ€æœ¯æŒ‡æ ‡ï¼›
     - åŸºäºé€ç¬”æˆäº¤/ç›˜å£èšåˆçš„é«˜é¢‘ç‰¹å¾ï¼ˆLSTM/DeepAR ç”¨ï¼‰ï¼›
     - å„ç±»å› å­ï¼ˆèµ„é‡‘ã€ç­¹ç ã€æƒ…ç»ªã€åŸºæœ¬é¢ç­‰ï¼‰ã€‚

3. **æ¨¡å‹å±‚ï¼ˆModel Layerï¼‰**
   - ç¬¬ä¸€å±‚ï¼š
     - ARIMAï¼šå•å˜é‡æ—¶é—´åºåˆ—åŸºçº¿ï¼›
     - HMMï¼šè¡Œæƒ… regime / å¾®è§‚çŠ¶æ€è¯†åˆ«ã€‚
   - ç¬¬äºŒå±‚ï¼š
     - LSTMï¼šé’ˆå¯¹**æ ¸å¿ƒè‡ªé€‰/æŒä»“ä¸ªè‚¡**çš„ 5m/15m çŸ­æœŸé¢„æµ‹ï¼›
     - DeepARï¼šåœ¨è¿‡æ»¤åçš„å…¨å¸‚åœº Universe ä¸Šçš„æ—¥çº§/60m æ¦‚ç‡é¢„æµ‹ã€‚

4. **ç»Ÿä¸€ Signal é€‚é…å±‚ï¼ˆSignal Adapter Layerï¼‰**
   - å„æ¨¡å‹å†…éƒ¨ä¿ç•™è‡ªå·±çš„ Raw Output æ ¼å¼ï¼›
   - ç”±é€‚é…å±‚å°† Raw Output æ˜ å°„åˆ°ç»Ÿä¸€çš„ `UnifiedSignal` å¯¹è±¡ï¼›
   - å¯¹åŒä¸€æ ‡çš„+å‘¨æœŸçš„å¤šæ¨¡å‹ä¿¡å·åšé›†æˆï¼ˆensembleï¼‰ï¼Œæä¾›ç»Ÿä¸€çš„æ•°å€¼/çŠ¶æ€æ¥å£ã€‚

5. **åˆ†æå¸ˆä¸ç­–ç•¥å±‚ï¼ˆAnalyst & Strategy Layerï¼‰**
   - æ–°å¢â€œé‡åŒ–åˆ†æå¸ˆâ€ï¼Œè¾“å‡ºåˆå§‹é‡åŒ– `UnifiedSignal`ï¼›
   - ç”±èµ„é‡‘æŠ€æœ¯åˆ†æå¸ˆã€åŸºæœ¬é¢åˆ†æå¸ˆã€é£é™©åˆ†æå¸ˆç­‰åŸºäº `UnifiedSignal` åšå¾®è°ƒï¼›
   - å½¢æˆæœ€ç»ˆé¢å‘ T+0 ä¸ä¸­ä½é¢‘è°ƒä»“çš„ç»¼åˆç­–ç•¥å»ºè®®ã€‚

---

## 3. æ¨¡å‹ä¸è®­ç»ƒé…ç½®ï¼ˆLSTM / DeepARï¼‰

### 3.1 LSTMï¼šè®­ç»ƒå¯¹è±¡èŒƒå›´ä¸ç­–ç•¥

#### 3.1.1 è®­ç»ƒå¯¹è±¡èŒƒå›´ï¼ˆåŒå±‚ç»“æ„ï¼‰

LSTM é‡‡ç”¨ **ç­–ç•¥ C çš„å¢å¼ºç‰ˆ**ï¼Œè®­ç»ƒèŒƒå›´åˆ†ä¸¤ä¸ªå±‚é¢ï¼š

1. **CoreUniverseï¼šæ ¸å¿ƒæ ‡çš„ per-stock æ¨¡å‹**
   - å®šä¹‰ï¼š
     - æ¥æºä¸ºç°æœ‰è‡ªé€‰è‚¡ç¥¨æ± è¡¨ `app.watchlist_items` ä¸­çš„è®°å½•ï¼›
     - é»˜è®¤åŒ…å«å½“å‰æ‰€æœ‰è‡ªé€‰è‚¡ç¥¨ï¼ˆæ‰€æœ‰åˆ†ç±»ï¼‰ï¼Œå…¶ä¸­å·²è‡ªç„¶åŒ…å«å½“å‰å®é™…æŒä»“è‚¡ç¥¨ï¼›
     - å¦‚éœ€æ›´ç²¾ç»†æ§åˆ¶ï¼Œå¯åœ¨é…ç½®ä¸­æŒ‡å®šå“ªäº›åˆ†ç±»ï¼ˆå¦‚â€œæ ¸å¿ƒæŒä»“â€â€œé«˜é¢‘Tæ ‡çš„â€ç­‰ï¼‰çº³å…¥ CoreUniverseã€‚
   - é…ç½®ï¼š
     - ä¸Šé™é»˜è®¤ **30â€“40 åª**ï¼Œå¯åœ¨é…ç½®ä¸­è‡ªå®šä¹‰ï¼ˆå¦‚ 20/30/40ï¼‰ï¼›
     - æ”¯æŒé€šè¿‡ UI/é…ç½®æ–‡ä»¶æ‰‹åŠ¨ç»´æŠ¤ CoreUniverse åˆ—è¡¨ã€‚
   - è®­ç»ƒæ–¹å¼ï¼š
     - å¯¹ CoreUniverse ä¸­æ¯ä¸€åªè‚¡ç¥¨ï¼Œè®­ç»ƒ **å•ç‹¬çš„ LSTM æ¨¡å‹**ï¼›
     - æ¨¡å‹æ–‡ä»¶æŒ‰ symbol+é¢‘ç‡å‘½åä¸ç‰ˆæœ¬ç®¡ç†ã€‚

2. **SharedUniverseï¼šå…¶å®ƒè‚¡ç¥¨çš„å…±äº« LSTM æ¨¡å‹**
   - å®šä¹‰ï¼šä»¥ DeepAR æ‰€ä½¿ç”¨çš„å…¨é‡è¿‡æ»¤ Universeï¼ˆæ»¡è¶³é ST / éé€€å¸‚ / ä¸Šå¸‚ â‰¥ 6 ä¸ªæœˆ / æ—¥å‡æˆäº¤é¢ â‰¥ 1000 ä¸‡ï¼‰ä¸ºåŸºç¡€ï¼Œæ‰£é™¤ CoreUniverse åå¾—åˆ°çš„å‰©ä½™è‚¡ç¥¨é›†åˆï¼›
   - è®­ç»ƒæ–¹å¼ï¼š
     - è®­ç»ƒä¸€ä¸ª **å…±äº« LSTM æ¨¡å‹**ï¼Œè¾“å…¥ä¸­åŒ…å«è‚¡ç¥¨ ID/è¡Œä¸š/å¸‚å€¼ç­‰è¾…åŠ©ç‰¹å¾ï¼›
     - è¯¥æ¨¡å‹åªä¸ºéæ ¸å¿ƒè‚¡ç¥¨æä¾›è¾…åŠ©çŸ­æœŸä¿¡å·ï¼Œæ ¸å¿ƒæ ‡çš„ä¼˜å…ˆä½¿ç”¨ per-stock æ¨¡å‹ã€‚

#### 3.1.2 æ•°æ®ç²’åº¦ï¼ˆLSTMï¼‰

- **ä¸»æ—¶é—´ç²’åº¦**ï¼š`5m` K çº¿ï¼›
- **å¯é€‰æ—¶é—´ç²’åº¦**ï¼š`15m` K çº¿ï¼ˆå¯é…ç½®æ˜¯å¦å¯ç”¨ï¼‰ï¼›
- è¾“å…¥ç‰¹å¾ç»„æˆï¼š
  - K çº¿åŸºç¡€ç‰¹å¾ï¼š`open, high, low, close, volume, amount`ï¼›
  - çŸ­å‘¨æœŸæŠ€æœ¯æŒ‡æ ‡ï¼šå¦‚ 5/10/20 bar MAã€é‡æ¯”ã€çŸ­å‘¨æœŸ RSV ç­‰ï¼›
  - é«˜é¢‘èšåˆç‰¹å¾ï¼ˆè¯¦è§ç¬¬ 4 ç« ï¼‰ï¼š
    - ä¹°å–ç›˜ä¸å¹³è¡¡åº¦ï¼›
    - ä¸»åŠ¨ä¹°/å–æˆäº¤é‡ã€æˆäº¤å æ¯”ï¼›
    - å¤§å•æˆäº¤é‡ã€ç¬”æ•°ä¸å æ¯”ï¼›
    - çŸ­å‘¨æœŸ realized volatilityï¼›
    - æˆäº¤ç¬”æ•°ã€å¹³å‡å•ç¬”æˆäº¤é‡ã€æˆäº¤å¼ºåº¦ç­‰ã€‚

#### 3.1.3 å†å²é•¿åº¦ï¼ˆLSTMï¼‰

- 5m çº§åˆ«è®­ç»ƒçª—å£ï¼šå»ºè®® **1.5â€“3 å¹´** å†å²ï¼›
- 15m çº§åˆ«è®­ç»ƒçª—å£ï¼ˆè‹¥å¯ç”¨ï¼‰ï¼šå»ºè®® **1â€“2 å¹´** å†å²ï¼›
- ä½¿ç”¨ **æ»‘åŠ¨çª—å£æ ·æœ¬æ„é€ **ï¼ˆlookback window 50â€“100 ä¸ªæ—¶é—´æ­¥ï¼‰ã€‚

#### 3.1.4 è®­ç»ƒé¢‘ç‡ï¼ˆLSTMï¼‰

- åˆå§‹è®­ç»ƒï¼š
  - å¯¹ CoreUniverse ä¸­çš„æ¯åªè‚¡ç¥¨ï¼Œå„è®­ç»ƒä¸€æ¬¡å®Œæ•´æ¨¡å‹ï¼›
  - å¯¹ SharedUniverse è®­ç»ƒä¸€ä¸ªå…±äº«æ¨¡å‹ï¼›
- å®šæœŸé‡è®­ï¼š
  - æ¨èé¢‘ç‡ï¼š**æ¯å‘¨ 1 æ¬¡**ï¼ˆå¯é…ç½®ï¼‰ï¼›
  - ä½¿ç”¨æœ€è¿‘ 1.5â€“3 å¹´æ•°æ®çš„æ»‘åŠ¨çª—å£è¿›è¡Œå…¨é‡é‡è®­æˆ–ä»æ—§ checkpoint ç»§ç»­è®­ç»ƒè‹¥å¹² epochã€‚

#### 3.1.5 å•æ¬¡è®­ç»ƒæ—¶é—´é¢„ç®—ï¼ˆLSTMï¼‰

- ç¡¬ä»¶ï¼šNVIDIA GeForce RTX 2060 6GBï¼›
- æ¨¡å‹è§„æ¨¡ï¼š1â€“2 å±‚ LSTMï¼Œhidden size 64â€“128ï¼Œbatch size 64â€“128ï¼›
- é¢„ç®—ï¼š
  - **åˆè®­**ï¼šçº¦ **10â€“20 åˆ†é’Ÿ/æ¯åª CoreUniverse è‚¡ç¥¨**ï¼›
  - **å‘¨åº¦é‡è®­**ï¼šçº¦ **5â€“15 åˆ†é’Ÿ/æ¯åª CoreUniverse è‚¡ç¥¨**ï¼›
  - Shared LSTM è§† Universe å¤§å°ä¸ epoch æ•°ï¼Œé¢„ç®— **30â€“90 åˆ†é’Ÿ**ã€‚

---

### 3.2 DeepARï¼šè®­ç»ƒ Universe ä¸é…ç½®

#### 3.2.1 è®­ç»ƒå¯¹è±¡èŒƒå›´ï¼ˆUniverse ç­›é€‰ï¼‰

DeepAR é’ˆå¯¹è¿‡æ»¤åçš„å…¨å¸‚åœº Universe è”åˆè®­ç»ƒï¼Œè¿‡æ»¤è§„åˆ™åˆ†ä¸ºâ€œç¡¬è¿‡æ»¤â€å’Œâ€œè½¯è¿‡æ»¤â€ï¼š

1. **ç¡¬è¿‡æ»¤ï¼ˆå¿…é¡»å‰”é™¤ï¼‰**ï¼š
   - å‰”é™¤ï¼šé€€å¸‚ã€ç»ˆæ­¢ä¸Šå¸‚ã€å·²é€€å¸‚ä»£ç ï¼›
   - å‰”é™¤ï¼šSTã€*ST ç­‰é£é™©è­¦ç¤ºè‚¡ï¼›
   - å‰”é™¤ï¼šåŒ—äº¤æ‰€è‚¡ç¥¨ï¼ˆäº¤æ˜“åˆ¶åº¦ä¸æµåŠ¨æ€§å·®å¼‚è¾ƒå¤§ï¼‰ã€‚

2. **è½¯è¿‡æ»¤ï¼ˆå½“å‰å·²é€‰æ‹©çš„å…·ä½“æ¡ä»¶ï¼‰**ï¼š
   - è¿‘ 1 å¹´æ—¥å‡æˆäº¤é¢è¿‡æ»¤ï¼š
     - ä¿ç•™ï¼šè¿‘ 1 å¹´æ—¥å‡æˆäº¤é¢ **â‰¥ 1000 ä¸‡å…ƒ** çš„è‚¡ç¥¨ï¼›
   - ä¸Šå¸‚æ—¶é—´è¿‡æ»¤ï¼š
     - ä¿ç•™ï¼šä¸Šå¸‚æ—¶é—´ **â‰¥ 6 ä¸ªæœˆ** çš„è‚¡ç¥¨ï¼›
   - ä¸Šè¿°é˜ˆå€¼åœ¨ `DeepARConfig` ä¸­å¯é…ç½®ï¼Œä½†é»˜è®¤ä½¿ç”¨ä»¥ä¸Šå€¼ã€‚

#### 3.2.2 æ•°æ®ç²’åº¦ä¸è¾“å…¥ç‰¹å¾ï¼ˆDeepARï¼‰

- **ä¸»æ—¶é—´ç²’åº¦**ï¼šæ—¥çº§ `1d`ï¼›
- **å¯é€‰æ—¶é—´ç²’åº¦**ï¼š`60m`ï¼Œå¯ä½œä¸ºç‹¬ç«‹ DeepAR æ¨¡å‹æˆ–ä¸æ—¥çº§å¹¶è¡Œéƒ¨ç½²ï¼›

- æ—¥çº§è¾“å…¥ç‰¹å¾ï¼š
  - K çº¿ï¼š`open, high, low, close, volume, amount`ï¼›
  - æ—¥çº§æŠ€æœ¯æŒ‡æ ‡ï¼šç§»åŠ¨å‡çº¿ã€æ³¢åŠ¨ç‡ã€é‡æ¯”ç­‰ï¼›
  - èµ„é‡‘/ç­¹ç /æƒ…ç»ª/åŸºæœ¬é¢å› å­ï¼ˆæ¥è‡ªç°æœ‰ç³»ç»Ÿï¼‰ï¼›
  - **ä»é«˜é¢‘èšåˆæ¥çš„æ—¥çº§å› å­**ï¼ˆè¯¦è§ 3.2.3ï¼‰ã€‚

#### 3.2.3 é«˜é¢‘èšåˆæ—¥çº§å› å­è®¾è®¡ï¼ˆDeepARï¼‰

åœ¨ç‰¹å¾å±‚ä¸­ï¼Œä»åˆ†é’Ÿ/é€ç¬”æ•°æ®èšåˆå¾—åˆ°ä»¥ä¸‹æ—¥çº§å› å­ï¼š

1. **æœ€å°å¿…é€‰å› å­ç»„ï¼ˆMinimalï¼‰**ï¼š
   - `intraday_realized_vol`ï¼š
     - å®šä¹‰ï¼šåŸºäºå½“æ—¥æ‰€æœ‰ 5m/15m æ”¶ç›Šçš„ realized volatilityï¼ˆå¹³æ–¹æ”¶ç›Šæ±‚å’Œå¼€æ–¹ï¼‰ï¼›
   - `intraday_high_low_ratio`ï¼š
     - å®šä¹‰ï¼š`(high - low) / close`ï¼›
   - `close_vs_vwap`ï¼š
     - å®šä¹‰ï¼š`(close - vwap) / vwap`ï¼Œ`vwap` ä¸ºæ—¥å†…æˆäº¤é‡åŠ æƒå¹³å‡ä»·ï¼›
   - `intraday_volume_imbalance`ï¼š
     - å®šä¹‰ï¼šæ—¥å†…ä¸»åŠ¨ä¹°é‡ä¸ä¸»åŠ¨å–é‡çš„å æ¯”å·®å€¼ï¼›
   - `big_trade_ratio`ï¼š
     - å®šä¹‰ï¼šå¤§å•æˆäº¤é¢ / æ€»æˆäº¤é¢ï¼ˆå¤§å•é˜ˆå€¼å¦‚ 20 ä¸‡/50 ä¸‡å…ƒï¼Œå¯é…ç½®ï¼‰ã€‚

2. **æ‰©å±•å› å­ç»„ï¼ˆExtendedï¼Œå·²é€‰æ‹©å®ç°ï¼‰**ï¼š
   - `opening_auction_impact`ï¼š
     - å®šä¹‰ï¼šå¼€ç›˜é˜¶æ®µï¼ˆå¦‚é¦– 5â€“10 åˆ†é’Ÿï¼‰çš„ä»·æ ¼è·³è·ƒå¹…åº¦ä¸æˆäº¤é‡ï¼Œè¡¡é‡é›†åˆç«ä»·/å¼€ç›˜å¼ºåº¦ï¼›
   - `late_session_intensity`ï¼š
     - å®šä¹‰ï¼šå°¾ç›˜æœ€å 30 åˆ†é’Ÿçš„æˆäº¤å¯†åº¦ä¸æ–¹å‘ï¼ˆä¸»åŠ¨ä¹°/å–å æ¯”ï¼‰ï¼›
   - `order_flow_skewness`ï¼š
     - å®šä¹‰ï¼šæ—¥å†… order-flowï¼ˆä¸»åŠ¨ä¹°å• - ä¸»åŠ¨å–å•ï¼‰çš„åˆ†å¸ƒååº¦ï¼Œè¡¡é‡æ”»é˜²ä¸€è¾¹å€’ç¨‹åº¦ï¼›
   - `intraday_vol_of_vol`ï¼š
     - å®šä¹‰ï¼šæ—¥å†…æ³¢åŠ¨ç‡è‡ªèº«çš„æ³¢åŠ¨åº¦ï¼ˆä¾‹å¦‚æŒ‰å­åŒºé—´ realized vol åºåˆ—çš„æ ‡å‡†å·®ï¼‰ã€‚

> ä»¥ä¸Šæ‰€æœ‰å› å­å‡å¯åŸºäº TDX å·²æä¾›çš„åˆ†é’Ÿçº§ K çº¿å’Œé€ç¬”æˆäº¤æ•°æ®è®¡ç®—ï¼Œä¸ä¾èµ–é¢å¤–æ•°æ®æºã€‚

#### 3.2.4 å†å²é•¿åº¦ä¸è®­ç»ƒé¢‘ç‡ï¼ˆDeepARï¼‰

- æ—¥çº§ï¼š
  - å†å²çª—å£ï¼š**3â€“5 å¹´**ï¼›
- 60m çº§ï¼š
  - å†å²çª—å£ï¼š**1â€“2 å¹´**ï¼›
- åˆå§‹è®­ç»ƒï¼š
  - å¯¹ç­›é€‰åçš„å…¨ Universe è‚¡ç¥¨ï¼Œä½¿ç”¨ä¸Šè¿°å†å²çª—å£è¿›è¡Œå®Œæ•´è®­ç»ƒï¼›
- å®šæœŸé‡è®­ï¼š
  - æ¨èé¢‘ç‡ï¼š**æ¯ 1â€“2 å‘¨ä¸€æ¬¡**ï¼Œä½¿ç”¨æœ€è¿‘ 3â€“5 å¹´æ»šåŠ¨çª—å£ï¼›
  - å¯é‡‡ç”¨â€œä»ä¸Šæ¬¡ checkpoint ç»§ç»­è®­ç»ƒè‹¥å¹² epochâ€çš„æ–¹å¼ç¼©çŸ­è€—æ—¶ã€‚

#### 3.2.5 å•æ¬¡è®­ç»ƒæ—¶é—´é¢„ç®—ï¼ˆDeepARï¼‰

- ç¡¬ä»¶ï¼šRTX 2060 6GBï¼›
- æ—¥çº§ DeepARï¼š
  - åˆè®­é¢„ç®—ï¼š**4â€“8 å°æ—¶**ï¼›
  - å‘¨/åŒå‘¨é‡è®­é¢„ç®—ï¼š**2â€“6 å°æ—¶**ï¼›
- 60m DeepARï¼ˆå¦‚å¯ç”¨ï¼‰ï¼š
  - é¢„ç®—ï¼š**2â€“4 å°æ—¶**ï¼Œæ ¹æ® Universe ä¸ epoch é…ç½®å¯è°ƒã€‚

---

## 4. LSTM é«˜é¢‘èšåˆç‰¹å¾å®ç°æ–¹æ¡ˆ

### 4.1 æ•°æ®æ¥æº

- TDX é€ç¬”æˆäº¤æ¥å£ï¼š`/api/trade`, `/api/trade-history`, `/api/minute-trade-all`ï¼›
- å¯é€‰ï¼šå®æ—¶ç›˜å£ `GET /api/quote`ï¼ˆç”¨äºæ‰©å±•ç‰¹å¾ï¼‰ã€‚

### 4.2 èšåˆç²’åº¦

- ä¸ LSTM ä¸»æ—¶é—´ç²’åº¦å¯¹é½ï¼š
  - ä»¥ `5m` ä¸ºä¸»ï¼Œå¯é€‰ `15m`ï¼›
- æ¯ä¸ªæ—¶é—´æ¡¶ `bucket`ï¼š
  - `[bucket_start_time, bucket_end_time)` å¯¹åº”ä¸€æ ¹ 5m/15m K çº¿ï¼›
  - åœ¨è¯¥åŒºé—´å†…èšåˆæ‰€æœ‰é€ç¬”æˆäº¤è®°å½•ã€‚

### 4.3 TimescaleDB èšåˆè¡¨è®¾è®¡ï¼ˆç¤ºæ„ï¼‰

åœ¨ç°æœ‰ TimescaleDB schema ä¸‹æ–°å¢ä¸€å¼ ä¸“ç”¨ hypertableï¼ˆåç§°å¯æ ¹æ®ç°æœ‰è§„èŒƒè°ƒæ•´ï¼‰ï¼š

- è¡¨ï¼š`ts_lstm_trade_agg`ï¼ˆç¤ºä¾‹åï¼‰
  - æ—¶é—´åˆ—ï¼š`bucket_start_time`ï¼ˆTIMESTAMPTZï¼Œä½œä¸º hypertable æ—¶é—´ç»´åº¦ï¼‰ï¼›
  - ç»´åº¦åˆ—ï¼š`symbol`ï¼ˆè‚¡ç¥¨ä»£ç ï¼‰ã€`freq`ï¼ˆå¦‚ `5m`/`15m`ï¼‰ï¼›
  - èšåˆç‰¹å¾åˆ—ï¼š
    - `buy_volume`, `sell_volume`, `neutral_volume`ï¼›
    - `order_flow_imbalance`ï¼›
    - `big_trade_volume`, `big_trade_count`, `big_trade_ratio`ï¼›
    - `realized_vol`ï¼›
    - `trade_count`, `avg_trade_size`, `intensity`ï¼›
    - å…¶å®ƒå¯é€‰æ‰©å±•å­—æ®µã€‚

> æ³¨ï¼šè¡¨ç»“æ„æœ€ç»ˆä»¥ç°æœ‰ TimescaleDB schema/å‘½åè§„èŒƒä¸ºå‡†ï¼Œæ­¤å¤„ä¸ºé€»è¾‘è®¾è®¡ã€‚

### 4.4 æ ¸å¿ƒèšåˆç‰¹å¾è®¡ç®—ï¼ˆå››ç±»ï¼Œå…¨éƒ¨å®ç°ï¼‰

å¯¹äºæ¯ä¸ª `symbol, bucket`ï¼š

1. **æˆäº¤æ–¹å‘ä¸ä¸å¹³è¡¡**
   - ä»é€ç¬”æ•°æ®ä¸­ç­›é€‰ `Status=ä¹°/å–/ä¸­æ€§`ï¼š
     - `buy_volume = Î£ volume(Status=ä¹°)`ï¼›
     - `sell_volume = Î£ volume(Status=å–)`ï¼›
     - `neutral_volume = Î£ volume(Status=ä¸­æ€§)`ï¼›
   - `order_flow_imbalance = (buy_volume - sell_volume) / (buy_volume + sell_volume + Îµ)`ã€‚

2. **ä¸»åŠ¨æ€§ä¸å¤§å•å æ¯”**
   - è®¾å¤§å•é˜ˆå€¼ä¸ºå•ç¬”æˆäº¤é¢ > `BigTradeThreshold`ï¼ˆé»˜è®¤ 20 ä¸‡/50 ä¸‡ï¼Œå¯é…ç½®ï¼‰ï¼š
     - `big_trade_volume = Î£ volume(trade_amount > threshold)`ï¼›
     - `big_trade_count = count(trade_amount > threshold)`ï¼›
     - `big_trade_ratio = big_trade_volume / (total_volume + Îµ)`ã€‚

3. **çŸ­å‘¨æœŸæ³¢åŠ¨ç‡**
   - åŸºäºé€ç¬”ä»·æ ¼æˆ–æ¡¶å†…æ›´ç»† K çº¿ï¼š
     - å°†æ¡¶å†…ä»·æ ¼åºåˆ—è®°ä¸º `p_i`ï¼Œæ”¶ç›Š `r_i = log(p_i / p_{i-1})`ï¼›
     - `realized_vol = sqrt(Î£ r_i^2)`ï¼›
   - è‹¥é€ç¬”ä»·æ ¼å¯†åº¦ä¸è¶³ï¼Œå¯é€€è€Œç”¨æ¡¶å†…é«˜ä½ä»·ä¼°ç®—æ³¢åŠ¨ç‡ï¼š
     - `realized_vol â‰ˆ (bucket_high - bucket_low) / bucket_close`ã€‚

4. **æˆäº¤å¯†åº¦ä¸èŠ‚å¥**
   - `trade_count = æ¡¶å†…é€ç¬”æˆäº¤ç¬”æ•°`ï¼›
   - `avg_trade_size = total_volume / max(trade_count, 1)`ï¼›
   - `intensity = trade_count / bucket_duration_minutes`ï¼ˆå¦‚ 5 åˆ†é’Ÿæ¡¶åˆ™é™¤ä»¥ 5ï¼‰ã€‚

### 4.5 ç‰¹å¾æ¥å…¥ LSTM

- åœ¨ LSTM è¾“å…¥ç‰¹å¾æ„é€ æ—¶ï¼š
  - é€šè¿‡ join `minute_bars` ä¸ `ts_lstm_trade_agg`ï¼Œåœ¨æ¯ä¸ªæ—¶é—´æ­¥æ‹¼æ¥ä¸Šè¿°ç‰¹å¾ï¼›
  - å½¢æˆ `X[t]` ä¸­çš„é«˜é¢‘ç‰¹å¾éƒ¨åˆ†ï¼›
- æ¨¡å‹ç»“æ„ä¸å¯¹è¿™äº›ç‰¹å¾åšç‰¹åˆ«åŒºåˆ†ï¼š
  - æ‰€æœ‰ç‰¹å¾åœ¨è¾“å…¥ç«¯åšæ ‡å‡†åŒ–/å½’ä¸€åŒ–åç»Ÿä¸€é€å…¥ LSTMï¼›
  - é‡è¦åº¦è¯„ä¼°å¯é€šè¿‡è®­ç»ƒååˆ†æï¼ˆå¦‚ feature importanceã€æ³¨æ„åŠ›å¯è§†åŒ–ç­‰ï¼‰ã€‚

---

## 5. æ¨¡å‹è®­ç»ƒç®¡ç†æ¨¡å—è®¾è®¡

### 5.1 èŒè´£ä¸åŠŸèƒ½

- ç®¡ç† LSTM ä¸ DeepAR æ¨¡å‹çš„ï¼š
  - åˆå§‹è®­ç»ƒä»»åŠ¡ï¼›
  - å‘¨æœŸæ€§é‡è®­ä»»åŠ¡ï¼›
  - è‡ªå®šä¹‰ä¸€æ¬¡æ€§è®­ç»ƒä»»åŠ¡ï¼ˆå¯æŒ‡å®šè‚¡ç¥¨èŒƒå›´ã€æ—¶é—´è·¨åº¦ã€æ•°æ®ç²’åº¦ï¼‰ï¼›
- ç®¡ç†æ¨ç†è°ƒåº¦ï¼š
  - æ¯å¤©ã€æ¯ 5â€“15 åˆ†é’Ÿæ‹‰æœ€æ–°æ•°æ®å¹¶æ‰§è¡Œå‰å‘æ¨ç†ï¼›
  - æ”¯æŒåªå¯¹æŒä»“/è‡ªé€‰ Universe æ‰§è¡Œæ¨ç†ï¼›
- è®°å½•ä¸å±•ç¤ºæ¨¡å‹è®­ç»ƒå…ƒä¿¡æ¯ï¼š
  - æ¯ä¸ªæ¨¡å‹çš„ï¼š
    - æœ€è¿‘è®­ç»ƒæ—¶é—´ï¼›
    - è®­ç»ƒè¦†ç›–çš„è‚¡ç¥¨èŒƒå›´ï¼ˆæ•°é‡ã€ç­›é€‰æ¡ä»¶æ‘˜è¦ï¼‰ï¼›
    - å†å²æ—¶é—´è·¨åº¦ï¼›
    - ä½¿ç”¨çš„æ•°æ®ç²’åº¦ï¼›
    - è®­ç»ƒè€—æ—¶ï¼›
    - å…³é”®æŒ‡æ ‡ï¼ˆè®­ç»ƒ/éªŒè¯ lossã€ç²¾åº¦ç­‰ï¼‰ã€‚
- æä¾›ï¼š
  - åå° APIï¼ˆRESTï¼‰ï¼›
  - å‰ç«¯/ç¨‹åº UI æŒ‰é’®è§¦å‘è®­ç»ƒä¸æ•°æ®åŒæ­¥ï¼›
  - å†…éƒ¨è°ƒåº¦å™¨ï¼ˆschedulerï¼‰å®šæ—¶è§¦å‘è®­ç»ƒä¸æ¨ç†ä»»åŠ¡ã€‚

### 5.2 æ•°æ®ç»“æ„ä¸ TimescaleDB å­˜å‚¨

åœ¨ TimescaleDB ä¸­æ–°å¢ç”¨äºç®¡ç†è®­ç»ƒä¸æ¨ç†å…ƒä¿¡æ¯çš„æ™®é€šè¡¨ï¼ˆé hypertableï¼‰ï¼š

1. **æ¨¡å‹é…ç½®è¡¨ `model_config`**ï¼ˆç¤ºæ„å­—æ®µï¼‰
   - `id`: ä¸»é”®ï¼›
   - `model_name`: å¦‚ `LSTM_PER_STOCK`, `LSTM_SHARED`, `DEEPAR_DAILY`, `DEEPAR_60M`ï¼›
   - `config_json`: JSONï¼ŒåŒ…å«ï¼š
     - è®­ç»ƒå¯¹è±¡èŒƒå›´ï¼ˆCoreUniverse åˆ—è¡¨å¼•ç”¨æ–¹å¼ï¼›DeepAR Universe è¿‡æ»¤è§„åˆ™ï¼‰ï¼›
     - æ•°æ®ç²’åº¦ï¼ˆ5m/15m/1d/60mï¼‰ï¼›
     - å†å²çª—å£é•¿åº¦ï¼›
     - è®­ç»ƒé¢‘ç‡ï¼ˆcron è¡¨è¾¾å¼æˆ–æ ‡å‡†æšä¸¾ï¼‰ï¼›
     - æ—¶é—´é¢„ç®—ä¸Šé™ï¼›
   - `enabled`: æ˜¯å¦å¯ç”¨è¯¥é…ç½®ï¼›
   - `created_at`, `updated_at`ã€‚

2. **è®­ç»ƒä»»åŠ¡è¡¨ `model_train_run`**
   - `id`: ä¸»é”®ï¼›
   - `model_name`ï¼›
   - `config_snapshot`: JSONï¼Œè®°å½•å¯åŠ¨æ—¶ä½¿ç”¨çš„é…ç½®å¿«ç…§ï¼›
   - `status`: `PENDING` / `RUNNING` / `SUCCESS` / `FAILED`ï¼›
   - `start_time`, `end_time`ï¼›
   - `duration_seconds`ï¼›
   - `symbols_covered_count`ï¼›
   - `time_range_start`, `time_range_end`ï¼›
   - `data_granularity`: 5m/15m/1d/60mï¼›
   - `metrics_json`: ä¿å­˜è®­ç»ƒ/éªŒè¯æŒ‡æ ‡ï¼›
   - `log_path`: è®­ç»ƒæ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼ˆå¯é€‰ï¼‰ã€‚

3. **æ¨ç†ä»»åŠ¡è¡¨ `model_inference_run`**
   - ç±»ä¼¼ `model_train_run`ï¼Œè®°å½•æ¯æ¬¡æ‰¹é‡æ¨ç†çš„æ‰§è¡Œï¼š
   - `schedule_name`, `symbols_covered`, `time_of_data`, `status`, `duration_seconds` ç­‰ã€‚

> æ‰€æœ‰è¿æ¥æ•°æ®åº“çš„å‚æ•°ä» `.env` ä¸­åŠ è½½ï¼Œæ²¿ç”¨ç°æœ‰ TimescaleDB è¿æ¥æ–¹å¼ã€‚

### 5.3 è°ƒåº¦ä¸æ‰§è¡Œï¼ˆé€‰é¡¹ Bï¼šé›†æˆåˆ°ç°æœ‰ backendï¼‰

- åœ¨ç°æœ‰ backend ä¸­é›†æˆä¸€ä¸ªè°ƒåº¦å™¨æ¨¡å—ï¼ˆä¸å·²æœ‰æœ¬åœ°æ•°æ®å…¥åº“è°ƒåº¦æœåŠ¡å…±è¿›ç¨‹è¿è¡Œï¼Œå¦‚ APScheduler æˆ–ç­‰ä»·å®ç°ï¼‰ï¼Œ**ä¸ä¾èµ– Windows è®¡åˆ’ä»»åŠ¡**ï¼š

  1. **è®­ç»ƒè°ƒåº¦**ï¼š
     - æ ¹æ® `model_config` ä¸­çš„è®­ç»ƒé¢‘ç‡é…ç½®ï¼š
       - å‘¨åº¦ä»»åŠ¡ï¼šLSTM per-stock/Sharedï¼›
       - å‘¨/åŒå‘¨ä»»åŠ¡ï¼šDeepARï¼ˆæ—¥çº§/60mï¼‰ï¼›
     - åœ¨è§¦å‘å…·ä½“è®­ç»ƒå‰ï¼Œå¯ç»“åˆç¬¬ 6 ç« ä¸­çš„æœ¬åœ°æ•°æ®ç®¡ç†çŠ¶æ€ï¼ˆå¦‚ `kline_daily_qfq`/`kline_minute_5m`/`trade_agg_5m` çš„è¦†ç›–èŒƒå›´å’Œæœ€è¿‘ ingestion job çŠ¶æ€ï¼‰æ£€æŸ¥æ•°æ®æ˜¯å¦å®Œæ•´ï¼Œå¿…è¦æ—¶å…ˆè§¦å‘è¡¥æ•°ä»»åŠ¡æˆ–è·³è¿‡æœ¬è½®è®­ç»ƒå¹¶è®°å½•åŸå› ï¼›
     - è°ƒåº¦å™¨æŒ‰è®¡åˆ’åˆ›å»º `model_train_run` è®°å½•å¹¶è§¦å‘å¯¹åº”è®­ç»ƒ Workerã€‚

  2. **æ¨ç†è°ƒåº¦**ï¼š
     - æ¯å¤©æˆ–æ¯ 5â€“15 åˆ†é’Ÿï¼š
       - è°ƒåº¦å™¨åˆ›å»º `model_inference_run` è®°å½•ï¼›
       - åœ¨æ‰§è¡Œå‰å‘æ¨ç†å‰ï¼ŒåŒæ ·æ ¹æ®ç¬¬ 6 ç« çš„æ•°æ®ç®¡ç†çŠ¶æ€ç¡®è®¤ç›®æ ‡æ—¶é—´ç‚¹çš„æ•°æ®ï¼ˆ5m/1d åŠé«˜é¢‘ç‰¹å¾ï¼‰æ˜¯å¦å·²å®ŒæˆåŒæ­¥ï¼Œä¸å®Œæ•´æ—¶å¯å‘èµ·å¢é‡è¡¥æ•°æˆ–è·³è¿‡æœ¬æ¬¡æ¨ç†ï¼›
       - æ‹‰å–æœ€æ–°æ•°æ®ï¼ˆå…ˆæœ¬åœ° DBï¼Œå†å¿…è¦æ—¶ TDX æ¥å£ï¼‰å¹¶æ‰§è¡Œå‰å‘æ¨ç†ï¼›
       - æ¨ç†ç»“æœå†™å…¥ç»Ÿä¸€ `Signal` å­˜å‚¨ï¼ˆå¯é€‰ï¼‰æˆ–ä»…åœ¨å†…å­˜ä¸­ä¾›åˆ†ææœåŠ¡ä½¿ç”¨ã€‚

- è®­ç»ƒä¸æ¨ç†æœ¬èº«ç”± Worker å‡½æ•°æ‰§è¡Œï¼š
  - Worker ä» DB è¯»å–é…ç½®ä¸æ•°æ®ï¼›
  - è°ƒç”¨å¯¹åº”æ¨¡å‹è®­ç»ƒ/æ¨ç†é€»è¾‘ï¼›
  - æ›´æ–° run è¡¨ä¸­çš„çŠ¶æ€ä¸æŒ‡æ ‡ã€‚

### 5.4 æ‰‹å·¥è§¦å‘ä¸ UI é›†æˆ

- åç«¯æä¾›å¦‚ä¸‹ APIï¼ˆç¤ºæ„ï¼‰ï¼š
  - `POST /api/models/train`ï¼šæ‰‹åŠ¨è§¦å‘æŸæ¨¡å‹çš„è®­ç»ƒï¼Œå¯æºå¸¦è¦†ç›–é…ç½®ï¼ˆç¬¦å·åˆ—è¡¨ã€æ—¶é—´èŒƒå›´ã€ç²’åº¦ç­‰ï¼‰ï¼›
  - `POST /api/models/inference`ï¼šæ‰‹åŠ¨è§¦å‘æŸæ¨¡å‹çš„æ¨ç†ï¼›
  - `GET /api/models/status`ï¼šæŸ¥è¯¢å„æ¨¡å‹æœ€æ–°è®­ç»ƒçŠ¶æ€ä¸å…ƒä¿¡æ¯ï¼›
  - `GET /api/models/runs`ï¼šåˆ†é¡µæŸ¥è¯¢å†å²è®­ç»ƒ/æ¨ç† run è®°å½•ã€‚

- å‰ç«¯æˆ–å†…éƒ¨ç®¡ç† UIï¼š
  - æä¾›æŒ‰é’®ï¼š
    - â€œæ‰‹åŠ¨è§¦å‘ LSTM è®­ç»ƒï¼ˆCoreUniverseï¼‰â€ï¼›
    - â€œæ‰‹åŠ¨è§¦å‘ DeepAR è®­ç»ƒâ€ï¼›
    - â€œç«‹å³æ‰§è¡Œä¸€æ¬¡å…¨å¸‚åœºæ¨ç†â€ï¼›
    - å±•ç¤ºï¼š
    - å„æ¨¡å‹æœ€è¿‘ä¸€æ¬¡è®­ç»ƒæ—¶é—´ã€è¦†ç›–èŒƒå›´ã€æ•°æ®ç²’åº¦ã€è®­ç»ƒè€—æ—¶ã€éªŒè¯æŒ‡æ ‡ç­‰ã€‚

---

## 6. æœ¬åœ°æ•°æ®ç®¡ç†ä¸åŒæ­¥ï¼ˆTimescaleDBï¼‰

> æœ¬èŠ‚åœ¨ä¸æ–°å¢ç‹¬ç«‹â€œæ•°æ®çœ‹æ¿â€é¡µé¢çš„å‰æä¸‹ï¼Œ**å¤ç”¨ç°æœ‰æœ¬åœ°æ•°æ®ç®¡ç†æ¨¡å—ä¸æ•°æ®çœ‹æ¿**ï¼ˆå·²é›†æˆåœ¨ä¸»åº”ç”¨ `app.py` ä¸ `tdx_ui.py` ä¸­ï¼‰ï¼Œå¹¶åœ¨å…¶åŸºç¡€ä¸Šè¡¥å……é‡åŒ–ç›¸å…³çš„æ•°æ®åˆå§‹åŒ–ã€å¢é‡åŒæ­¥ä¸æ–­ç‚¹ç»­ä¼ èƒ½åŠ›ã€‚

### 6.1 å¤ç”¨çš„æœ¬åœ°è¡¨ä¸æ•°æ®æº

æœ¬è®¾è®¡ä¸å†ä¸ºæ—¥ K / åˆ†é’Ÿ K å¦å»ºä¸€å¥— `ts_*` è¡¨ï¼Œè€Œæ˜¯ç»Ÿä¸€å¤ç”¨ç°æœ‰ `market` schema ä¸­çš„ Timescale hypertableï¼š

1. **æ—¥çº¿è¡¨**
   - `market.kline_daily_qfq`ï¼šå‰å¤æƒæ—¥çº¿ï¼Œä½œä¸ºæ—¥çº§è®­ç»ƒ/ç‰¹å¾ä¸»æ•°æ®æºï¼›
   - `market.kline_daily_raw`ï¼šæœªå¤æƒæ—¥çº¿ï¼Œä½œä¸ºçœŸå®æˆäº¤ä»·ã€æ”¶ç›Šå›æµ‹ä¸èµ„é‡‘æ›²çº¿å‚è€ƒï¼›
2. **åˆ†é’Ÿè¡¨**
   - `market.kline_minute_raw`ï¼š1 åˆ†é’Ÿæœªå¤æƒåˆ†é’Ÿçº¿ï¼Œæ˜¯ 5 åˆ†é’Ÿèšåˆä¸é«˜é¢‘ç‰¹å¾çš„åº•å±‚æ•°æ®æºï¼›
3. **5 åˆ†é’Ÿèšåˆè§†å›¾**
   - ä¸é¢å¤–æ–°å»ºç‰©ç† 5 åˆ†é’Ÿè¡¨ï¼Œä½¿ç”¨ Timescale **continuous aggregate / ç‰©åŒ–è§†å›¾** ä» `kline_minute_raw` èšåˆå¾—åˆ° `market.kline_minute_5m`ï¼ˆç¤ºæ„åï¼‰ï¼Œä¾› LSTM/DeepAR ä½¿ç”¨ï¼›
4. **é«˜é¢‘èšåˆç‰¹å¾è¡¨**
   - ç‹¬ç«‹ hypertableï¼ˆå¦‚ `market.trade_agg_5m` æˆ– `app.ts_lstm_trade_agg`ï¼‰ï¼ŒæŒ‰ `symbol + bucket_start_time + freq` å­˜å‚¨ 5 åˆ†é’Ÿç²’åº¦çš„ order-flowã€ä¸å¹³è¡¡åº¦ã€å¤§å•ç»Ÿè®¡ä¸ realized volatility ç­‰ç‰¹å¾ã€‚

> è¯´æ˜ï¼šä¸Šè¿°è¡¨ä¸ hypertable å·²åœ¨ `scripts/init_market_schema.py` ä¸­å®šä¹‰æˆ–å¯æŒ‰æ—¢æœ‰è§„èŒƒæ‰©å±•ï¼›æœ¬æ–¹æ¡ˆä¸å†å¼•å…¥æ–°çš„å¤§ä½“é‡å†å²è¡Œæƒ…è¡¨ï¼Œé¿å…é‡å¤å­˜å‚¨ã€‚

### 6.2 åˆå§‹åŒ–å…¨é‡åŒæ­¥ï¼ˆinit æ¨¡å¼ï¼‰

æœ¬åœ°æ•°æ®çš„**å…¨é‡åˆå§‹åŒ–**å¤ç”¨ç°æœ‰çš„ TDX ingestion è„šæœ¬ä¸æ§åˆ¶è¡¨ï¼š

- æ—¥çº¿ï¼š
  - ä½¿ç”¨ç°æœ‰ full ingestion è„šæœ¬ï¼ˆå¦‚ `ingest_full_daily*.py`ï¼‰å°† TDX æ—¥ K æ‹‰å–åˆ° `market.kline_daily_qfq` / `market.kline_daily_raw`ï¼›
- åˆ†é’Ÿï¼š
  - ä½¿ç”¨ `scripts/ingest_full_minute.py` å°† 1 åˆ†é’Ÿæ•°æ®å…¨é‡åŒæ­¥åˆ° `market.kline_minute_raw`ï¼›
- é«˜é¢‘èšåˆç‰¹å¾ï¼š
  - ä½¿ç”¨ä¸“é—¨çš„ quant è„šæœ¬ï¼ˆå¦‚å‰æ–‡çš„ trade_agg åŒæ­¥è„šæœ¬ï¼‰ä» `/api/minute-trade-all` æ‹‰å–é€ç¬”æˆäº¤ï¼Œèšåˆå†™å…¥ `trade_agg_5m`ã€‚

æ‰€æœ‰ init ä»»åŠ¡éƒ½é€šè¿‡å·²æœ‰çš„ ingestion æ§åˆ¶è¡¨è¿›è¡Œç®¡ç†ä¸æ–­ç‚¹ç»­ä¼ ï¼š

- `market.ingestion_jobs`ï¼šè®°å½•æœ¬æ¬¡åˆå§‹åŒ– jobï¼ˆdatasetã€æ¨¡å¼=initã€å‚æ•°ã€çŠ¶æ€ã€ç»Ÿè®¡ä¿¡æ¯ï¼‰ï¼›
- `market.ingestion_runs`ï¼šè®°å½•è„šæœ¬ run çº§åˆ«çš„ä¿¡æ¯ï¼ˆå¤šæ¬¡æ‰§è¡ŒåŒä¸€ job æ—¶å¯åŒºåˆ†ï¼‰ï¼›
- `market.ingestion_checkpoints`ï¼šæŒ‰ `run_id + dataset + ts_code` ç»´åº¦è®°å½•å½“å‰å¤„ç†åˆ°çš„ `cursor_date` / `cursor_time`ï¼›
- `market.ingestion_state`ï¼šæŒ‰ `dataset + ts_code` ç»´åº¦è®°å½•æœ€è¿‘ä¸€æ¬¡æˆåŠŸåŒæ­¥åˆ°çš„æ—¥æœŸ/æ—¶é—´ï¼›
- `market.ingestion_errors`ï¼šè®°å½•æ¯åªè‚¡ç¥¨/æ—¥æœŸçš„é”™è¯¯è¯¦æƒ…ã€‚

> ä¾æ‰˜ä¸Šè¿°å…ƒæ•°æ®è¡¨ï¼Œ**å…¨é‡åˆå§‹åŒ–åœ¨ç½‘ç»œ/TDX æ¥å£ä¸­æ–­åå¯ä»¥å®‰å…¨é‡å¯**ï¼šè„šæœ¬ä¼šä»æœ€è¿‘çš„ checkpoint ç»§ç»­å¤„ç†ï¼Œæ‰€æœ‰æ’å…¥å‡ä½¿ç”¨ `INSERT ... ON CONFLICT DO UPDATE` ä¿è¯å¹‚ç­‰é‡è·‘ã€‚

### 6.3 æ—¥å¸¸å¢é‡åŒæ­¥ï¼ˆincremental æ¨¡å¼ï¼‰

æ—¥å¸¸å¢é‡åŒæ­¥ç»Ÿä¸€ç”± `scripts/ingest_incremental.py` é©±åŠ¨ï¼Œå¹¶ç”±åå°è°ƒåº¦æœåŠ¡ï¼ˆ`tdx_scheduler.py`ï¼‰æŒ‰ `dataset + mode=incremental` è°ƒç”¨ï¼š

1. **æ—¥çº¿å¢é‡**ï¼ˆ`kline_daily_qfq` / `kline_daily_raw`ï¼‰
   - æ¯ä¸ªäº¤æ˜“æ—¥æ”¶ç›˜åï¼š
     - æŒ‰ `ingestion_state` ä¸­çš„æœ€è¿‘æ—¥æœŸä¸ºèµ·ç‚¹ï¼Œæ‹‰å–å½“æ—¥ï¼ˆæˆ–æœ€è¿‘ N æ—¥ï¼‰æ—¥ Kï¼›
     - å†™å…¥å¯¹åº”è¡¨ï¼Œæ›´æ–° state ä¸ checkpointsï¼›
   - æ”¯æŒä» UI/æ¥å£æ‰‹å·¥è§¦å‘æŒ‡å®š `start_date/end_date` çš„è¡¥æ•°ä»»åŠ¡ã€‚

2. **åˆ†é’Ÿå¢é‡**ï¼ˆ`kline_minute_raw`ï¼‰
   - ç›˜ä¸­æˆ–æ”¶ç›˜åå®šæœŸï¼š
     - ä½¿ç”¨ `ingest_incremental.py` çš„ `kline_minute_raw` è·¯å¾„ï¼Œå¯¹ç›®æ ‡ `target_date` è¿›è¡Œå¢é‡è¡¥æ•°ï¼›
     - é€šè¿‡ `ingestion_state` ä¸ `ingestion_checkpoints` è®°å½•æ¯åªè‚¡ç¥¨å·²è¡¥é½åˆ°çš„åˆ†é’Ÿæ¸¸æ ‡ï¼›
   - 5 åˆ†é’Ÿè§†å›¾ `kline_minute_5m` ç”± Timescale è‡ªåŠ¨/å®šæœŸåˆ·æ–°ï¼ˆcontinuous aggregateï¼‰ï¼Œæ— éœ€é¢å¤–åŒæ­¥é€»è¾‘ã€‚

3. **é«˜é¢‘èšåˆå¢é‡**ï¼ˆ`trade_agg_5m`ï¼‰
   - å¯¹æŒä»“/è‡ªé€‰è‚¡ç¥¨é›†åˆï¼š
     - æ¯æ—¥æˆ–æ¯ N åˆ†é’Ÿè°ƒç”¨ trade_agg åŒæ­¥è„šæœ¬ï¼Œä»æœ€è¿‘ä¸€æ¬¡æˆåŠŸ bucket èµ·å¢é‡æ›´æ–°ï¼›
     - ä½¿ç”¨ä¸åˆ†é’Ÿå¢é‡ç±»ä¼¼çš„ state/checkpoint è¡¨ç»“æ„ï¼Œä¿éšœæ–­ç‚¹ç»­ä¼ ä¸å¹‚ç­‰æ›´æ–°ã€‚

> æ•´ä½“åŸåˆ™ï¼š**æ‰€æœ‰å¢é‡åŒæ­¥å‡åªè¿½åŠ /è¦†ç›–ï¼Œä¸åš TRUNCATE**ï¼Œå¹¶ä¾æ‰˜ ingestion æ§åˆ¶è¡¨å®ç°å¯è§‚æµ‹ã€å¯æ¢å¤çš„æµæ°´çº¿ã€‚

### 6.4 å¤æƒä¸æ—¥çº¿é‡ç®—ï¼ˆrebuild / adjust æ¨¡å¼ï¼‰

å½“å¤æƒå› å­æ›´æ–°æˆ–éœ€è¦é‡æ–°æ„å»ºå‰/åå¤æƒä»·æ ¼æ—¶ï¼Œé€šè¿‡ä¸“é—¨çš„ `dataset`ï¼ˆå¦‚ `adjust_daily` / `kline_adjust_daily`ï¼‰è§¦å‘ **rebuild æ¨¡å¼** jobï¼š

- æŒ‰è‚¡ç¥¨é›†åˆ + æ—¥æœŸåŒºé—´é‡ç®— `kline_daily_qfq` / `kline_daily_hfq`ï¼›
- æ¯åªè‚¡ç¥¨ã€æ¯ä¸ªæ—¥æœŸåœ¨æˆåŠŸå†™å…¥åæ›´æ–° `ingestion_state` ä¸ `ingestion_checkpoints`ï¼›
- è‹¥ä¸­é€”ä¸­æ–­ï¼Œå¯ä»æŒ‡å®šçš„ job æˆ– run é‡å¯ï¼Œè‡ªåŠ¨ä»æœªå®Œæˆéƒ¨åˆ†ç»§ç»­ã€‚

> rebuild æ¨¡å¼ä¸ init/incremental å…±ç”¨åŒä¸€å¥— ingestion æ§åˆ¶ä¸ UI/è°ƒåº¦æ¡†æ¶ï¼Œä»…åœ¨ `dataset` ä¸ `mode` å­—æ®µä¸ŠåŠ ä»¥åŒºåˆ†ã€‚

### 6.5 ä¸ç°æœ‰æœ¬åœ°æ•°æ®ç®¡ç†é¡µé¢ / æ•°æ®çœ‹æ¿çš„é›†æˆ

æœ¬ç³»ç»Ÿå·²ç»åœ¨ä¸»åº”ç”¨ä¸­é›†æˆâ€œğŸ—„ï¸ æœ¬åœ°æ•°æ®ç®¡ç†â€å…¥å£å’Œç›¸å…³æ•°æ®çœ‹æ¿é¡µé¢ï¼ˆè§ `app.py` ä¸ `tdx_ui.py`ï¼‰ï¼š

- **æ•°æ®å…¥åº“è°ƒåº¦é¡µ**ï¼ˆ`_render_ingestion_tab`ï¼‰ï¼š
  - é€šè¿‡ `/api/ingestion/schedule` ä¸ `/api/ingestion/run` ç®¡ç† ingestion è°ƒåº¦ä¸ä¸€æ¬¡æ€§ä»»åŠ¡ï¼›
  - Dataset é€‰é¡¹ä¸­å°†è¡¥å……é‡åŒ–ç›¸å…³æ•°æ®é›†ï¼ˆå¦‚ `kline_daily_qfq`, `kline_daily_raw`, `kline_minute_raw`, `trade_agg_5m`ï¼‰ï¼Œä»¥ä¾¿ç»Ÿä¸€ç®¡ç†ï¼›
  - æ”¯æŒåˆ›å»º/ä¿®æ”¹/å¯ç”¨/åœç”¨è°ƒåº¦ï¼Œä»¥åŠâ€œç«‹å³è¿è¡Œâ€æŸä¸ª scheduleã€‚

- **ä»»åŠ¡ç›‘è§†å™¨ / æ•°æ®çœ‹æ¿é¡µ**ï¼ˆ`_render_task_monitor`ï¼‰ï¼š
  - é€šè¿‡ `/api/ingestion/jobs` å±•ç¤ºæœ€è¿‘ ingestion job çš„çŠ¶æ€ã€è¿›åº¦ã€ç»Ÿè®¡ï¼ˆæ’å…¥è¡Œæ•°ã€æˆåŠŸ/å¤±è´¥è‚¡ç¥¨æ•°ç­‰ï¼‰ä¸é”™è¯¯æ ·æœ¬ï¼›
  - ä¸å†æ–°å»ºé¢å¤–â€œé‡åŒ–æ•°æ®çœ‹æ¿â€é¡µé¢ï¼Œè€Œæ˜¯åŸºäºç°æœ‰ä»»åŠ¡ç›‘è§†ä¸ç»Ÿè®¡ä¿¡æ¯åˆ¤æ–­ï¼š
    - æ—¥çº¿/åˆ†é’Ÿçº¿/é«˜é¢‘ç‰¹å¾æ˜¯å¦å·²è¦†ç›–åˆ°ç›®æ ‡æ—¥æœŸï¼›
    - æ˜¯å¦å­˜åœ¨æŸäº›è‚¡ç¥¨åœ¨æœ€è¿‘ N æ—¥åŒæ­¥å¤±è´¥ï¼›
    - å“ªäº› job éœ€è¦ä»æ–­ç‚¹é‡è¯•æˆ–è¡¥æ•°ã€‚

> é€šè¿‡ä¸Šè¿°å¤ç”¨æ–¹å¼ï¼Œé‡åŒ–ç›¸å…³æ•°æ®åŒæ­¥å®Œå…¨çº³å…¥å·²æœ‰â€œæœ¬åœ°æ•°æ®ç®¡ç† + æ•°æ®çœ‹æ¿â€ä½“ç³»ï¼Œæ— éœ€é¢å¤–å¼€å‘æ–°çš„ UI é¡µé¢ã€‚

### 6.6 ä¸è®­ç»ƒæ•°æ®éœ€æ±‚çš„è¡”æ¥

- LSTM / DeepAR è®­ç»ƒå‰ï¼Œè®­ç»ƒç®¡ç†æ¨¡å—å¯é€šè¿‡ ingestion job/state è¡¨ä¸ç°æœ‰æ•°æ®çœ‹æ¿æ£€æŸ¥ï¼š
  - `kline_daily_qfq` æ˜¯å¦å·²è¦†ç›–æœ€è¿‘ 3â€“5 å¹´ï¼ˆDeepARï¼‰æˆ– 1.5â€“3 å¹´ï¼ˆLSTMï¼‰çš„æ—¥çº§æ•°æ®ï¼›
  - `kline_minute_5m` èƒŒåçš„ `kline_minute_raw` æ˜¯å¦å·²è¦†ç›–æœ€è¿‘ 1.5â€“3 å¹´çš„ 1 åˆ†é’Ÿæ•°æ®ï¼›
  - é«˜é¢‘èšåˆç‰¹å¾è¡¨åœ¨è®­ç»ƒåŒºé—´å†…æ˜¯å¦å®Œæ•´ã€‚
- å½“æ£€æµ‹åˆ°æ•°æ®ç¼ºå£æˆ–æœ€è¿‘ job å¤±è´¥æ—¶ï¼š
  - é€šè¿‡æœ¬åœ°æ•°æ®ç®¡ç†é¡µé¢æ‰‹åŠ¨è§¦å‘å¯¹åº” dataset çš„ init / incremental / rebuild ä»»åŠ¡è¿›è¡Œè¡¥æ•°ï¼›
  - æˆ–ç”±è®­ç»ƒè°ƒåº¦åœ¨åå°è‡ªåŠ¨å‘èµ·è¡¥æ•° jobï¼Œå¹¶åœ¨å¤±è´¥æ—¶å†™å…¥å‘Šè­¦æ—¥å¿—ä¾› UI å±•ç¤ºã€‚

> å†³ç­–çº¦æŸï¼šå½“å‰é˜¶æ®µ **ä¸ç›´æ¥åœ¨ 1 åˆ†é’Ÿçº§åˆ«ä¸Šè®­ç»ƒæ¨¡å‹**ï¼Œä»…å°† 1 åˆ†é’ŸåŸå§‹æ•°æ®ä½œä¸º 5 åˆ†é’Ÿèšåˆä¸é«˜é¢‘ç‰¹å¾çš„åº•å±‚æ”¯æ’‘ï¼Œä»è€Œåœ¨å¯æ§çš„è®­ç»ƒè€—æ—¶å†…è·å¾—è¾ƒå¥½çš„ T+0 é¢„æµ‹æ•ˆæœã€‚

---

## 7. æ‰§è¡Œæ­¥éª¤ä¸è¿›åº¦è·Ÿè¸ª

> è¯´æ˜ï¼šæœ¬èŠ‚ä½œä¸º**æ‰§è¡Œè·¯çº¿å›¾ä¸è¿›åº¦è®°å½•**ï¼Œæ¯å®Œæˆä¸€æ­¥åº”åœ¨æœ¬è¡¨ä¸­æ›´æ–°çŠ¶æ€ä¸å®Œæˆæ—¶é—´ã€‚

### 7.1 é˜¶æ®µä¸æ­¥éª¤åˆ—è¡¨

| é˜¶æ®µ | æ­¥éª¤ç¼–å· | æ­¥éª¤æè¿° | çŠ¶æ€ | å¤‡æ³¨/å®Œæˆæ—¶é—´ |
|------|----------|----------|------|---------------|
| 0 | 0.1 | å®Œæˆé‡åŒ–æ¨¡å‹è¯„ä¼°æŠ¥å‘Š `quant_model_evaluation.md` | å·²å®Œæˆ | é€šè¿‡ç°æœ‰æ–‡æ¡£å®Œæˆ |
| 0 | 0.2 | å®Œæˆæœ¬è®¾è®¡æ–¹æ¡ˆæ–‡æ¡£ `quant_analyst_design.md` åˆç¨¿ | å·²å®Œæˆ | å½“å‰ç‰ˆæœ¬ v0.1 |
| 1 | 1.1 | åœ¨ TimescaleDB ä¸­åˆ›å»ºæ—¥ Kã€åˆ†é’Ÿ Kã€trade_agg ç­‰æ—¶åºè¡¨ | å·²å®Œæˆ | å¤ç”¨ç°æœ‰ `market.kline_daily_*`ã€`market.kline_minute_raw`ã€`market.trade_agg_5m` ç­‰è¡¨ |
| 1 | 1.2 | å®ç° TDX â†’ TimescaleDB çš„æ—¥ K å…¨é‡åŒæ­¥è„šæœ¬/API | å·²å®Œæˆ | `scripts/ingest_full_daily*.py` + ingestion æ¥å£å·²åœ¨è¿è¡Œ |
| 1 | 1.3 | å®ç° TDX â†’ TimescaleDB çš„åˆ†é’Ÿ K å…¨é‡åŒæ­¥è„šæœ¬/API | å·²å®Œæˆ | `scripts/ingest_full_minute.py` + ingestion è°ƒåº¦å·²å°±ç»ª |
| 1 | 1.4 | å®ç°å¯¹ CoreUniverse/holding/watchlist çš„é«˜é¢‘èšåˆå…¨é‡å…¥åº“ | è¿›è¡Œä¸­ | å·²æœ‰ `trade_agg_5m` åŒæ­¥è„šæœ¬ä¸ datasetï¼Œéœ€æŒ‰ CoreUniverse/holding èŒƒå›´å®Œå–„ |
| 2 | 2.1 | å®ç°æ—¥ Kã€åˆ†é’Ÿ Kã€trade_agg çš„å¢é‡åŒæ­¥ä»»åŠ¡ä¸å®šæ—¶è°ƒåº¦ | è¿›è¡Œä¸­ | `scripts/ingest_incremental.py` + `backend/ingestion/tdx_scheduler.py` å·²ç”¨äºæ—¥/åˆ†é’Ÿ/trade_agg å¢é‡ |
| 2 | 2.2 | å®Œæˆæ•°æ®è´¨é‡æ£€æŸ¥ä¸å‘Šè­¦æœºåˆ¶ | è¿›è¡Œä¸­ | å·²æœ‰æ•°æ®çœ‹æ¿ä¸ gaps æ¥å£ï¼Œç”¨äºç¼ºå£æ£€æŸ¥ï¼Œå‘Šè­¦ä¸è‡ªåŠ¨åŒ–éƒ¨åˆ†å¾…è¡¥å…… |
| 3 | 3.1 | åŸºäº `market.kline_minute_5m` + é«˜é¢‘èšåˆè¡¨æ„å»º LSTM è®­ç»ƒæ•°æ®é›†ï¼ˆå« CoreUniverse / SharedUniverseï¼‰ | è¿›è¡Œä¸­ | `backend/quant_datasets/lstm_dataset.py` å·²å®ç°æ ¸å¿ƒæ•°æ®é›†æ„å»ºé€»è¾‘ |
| 3 | 3.2 | å®ç° per-stock LSTM è®­ç»ƒä¸æ¨ç†æ¥å£ï¼ˆ5m ç²’åº¦ï¼‰ | è¿›è¡Œä¸­ | `backend/quant_models/lstm/train_per_stock.py` / `infer_per_stock.py` å·²è¿å…¥ï¼Œå¾…ä¸æ–°è°ƒåº¦/æœåŠ¡è”è°ƒ |
| 3 | 3.3 | å®ç° Shared LSTM è®­ç»ƒä¸æ¨ç†æ¥å£ï¼ˆ5m ç²’åº¦ï¼‰ | è¿›è¡Œä¸­ | `backend/quant_models/lstm/train_shared.py` / `infer_shared.py` å·²è¿å…¥ï¼Œå¾…è”è°ƒ |
| 3 | 3.4 | åŸºäº `market.kline_daily_qfq` + æ—¥çº§é«˜é¢‘å› å­æ„å»º DeepAR è®­ç»ƒæ•°æ®é›† | è¿›è¡Œä¸­ | `backend/quant_datasets/deepar_dataset.py` å·²å®ç°æ•°æ®é›†æ„å»ºæ¡†æ¶ |
| 3 | 3.5 | å®ç° DeepAR è®­ç»ƒä¸æ¨ç†æ¥å£ï¼ˆæ—¥çº§/60mï¼‰ | è¿›è¡Œä¸­ | `backend/quant_models/deepar/train.py` / `infer.py` å·²è¿å…¥ï¼Œå¾…åœ¨æ–°ç¯å¢ƒä¸­éªŒè¯ |
| 4 | 4.1 | å®ç°æ¨¡å‹è®­ç»ƒç®¡ç†æ¨¡å—çš„ DB è¡¨ï¼ˆmodel_config, model_train_run ç­‰ï¼‰ | å·²å®Œæˆ | `backend/db/init_quant_schema.py` åœ¨ `app` schema ä¸‹åˆ›å»º `model_*`ã€`quant_unified_signal` ç­‰è¡¨ |
| 4 | 4.2 | é›†æˆåå°è°ƒåº¦å™¨å¹¶é…ç½® LSTM/DeepAR è®­ç»ƒä»»åŠ¡ | è¿›è¡Œä¸­ | `backend/model_scheduler/scheduler.py` å·²å®ç° DB é©±åŠ¨è°ƒåº¦ï¼Œæ¨¡å—è·¯å¾„ä¸å…·ä½“ schedule é…ç½®å¾…å®Œå–„ |
| 4 | 4.3 | é›†æˆæ¨ç†è°ƒåº¦ï¼ˆæ¯æ—¥ & æ¯ 5â€“15 åˆ†é’Ÿï¼‰ | è¿›è¡Œä¸­ | åŒä¸Šï¼Œæ¨ç†ä»»åŠ¡å…¥å£ä¸ schedule éœ€è¦æŒ‰æ–°ç¯å¢ƒå®é™…ä½¿ç”¨å®Œå–„ |
| 4 | 4.4 | æä¾›æ¨¡å‹ç®¡ç† API ä¸ç®€å• UI æŒ‰é’® | æœªå¼€å§‹ | |
| 5 | 5.1 | é›†æˆ Quant Analyst ä¸ UnifiedSignal è‡³åˆ†ææœåŠ¡ï¼Œæ¶ˆè´¹é˜¶æ®µ 3/4 äº§ç”Ÿçš„ `quant_unified_signal`ï¼Œæ¥å…¥ trend_analysis/analysis_service | è¿›è¡Œä¸­ | å·²æ–°å¢ `/api/quant/signals` è·¯ç”±ä¸ `quant_analyst_service`ï¼Œ`run_quant_analyst` ä¸åˆ†ææœåŠ¡é›†æˆå¾…å®Œæˆ |
| 5 | 5.2 | å°†é‡åŒ–åˆ†æå¸ˆè¾“å‡ºä¸èµ„é‡‘/åŸºæœ¬é¢/é£é™©åˆ†æå¸ˆå¾®è°ƒæ•´åˆ | æœªå¼€å§‹ | |
| 5 | 5.3 | å¯¹æ–°æ¶æ„è¿›è¡Œå›æµ‹ä¸çº¿ä¸Šç›‘æ§ï¼Œè¯„ä¼°æ•ˆæœ | æœªå¼€å§‹ | |

> åç»­æ¯æ¬¡å®ç°ä¸€ä¸ªæ­¥éª¤ï¼Œéœ€è¦åœ¨æ­¤è¡¨ä¸­æ›´æ–°â€œçŠ¶æ€â€å’Œâ€œå¤‡æ³¨/å®Œæˆæ—¶é—´â€ï¼Œä»¥ä¾¿é•¿æœŸè¿½è¸ªæ•´ä½“æ¨è¿›æƒ…å†µã€‚

---

## 8. å­—æ®µçº§è¡¨ç»“æ„ä¸ API è®¾è®¡

æœ¬ç« åœ¨å‰æ–‡é€»è¾‘è®¾è®¡åŸºç¡€ä¸Šï¼Œç»†åŒ–ï¼š

- æ‰€æœ‰æ¶‰åŠçš„æ ¸å¿ƒè¡¨ç»“æ„ï¼ˆè¡¨åã€å­—æ®µåã€å­—æ®µç±»å‹ã€å«ä¹‰ï¼‰ï¼›
- REST API çš„ URLã€æ–¹æ³•ã€è¯·æ±‚/å“åº” JSON å­—æ®µï¼›
- é«˜é¢‘å› å­å­—æ®µåœ¨å­˜å‚¨ä¸ API ä¸­çš„å‘½åä¸ç±»å‹ã€‚

> è¯´æ˜ï¼šSQL ç±»å‹ä»¥ PostgreSQL/TimescaleDB ä¸ºåŸºå‡†ï¼Œå®é™…å»ºè¡¨æ—¶å¯æŒ‰éœ€è¦å¾®è°ƒç²¾åº¦ä¸ç´¢å¼•ã€‚

### 8.1 UnifiedSignal å­˜å‚¨è¡¨

ç”¨äºå¯é€‰åœ°æŒä¹…åŒ–ç»Ÿä¸€ä¿¡å·ï¼ˆé‡åŒ–åˆ†æå¸ˆ + å¤šåˆ†æå¸ˆå¾®è°ƒå‰/åçš„ä¿¡å·ï¼‰ï¼Œä¾¿äºå›æ”¾ä¸å›æµ‹ã€‚

- è¡¨åï¼š`quant_unified_signal`
- ç”¨é€”ï¼šè®°å½•æŸä¸€æ—¶åˆ»æŸæ ‡çš„åœ¨æŸå‘¨æœŸ/horizon ä¸‹çš„ç»¼åˆä¿¡å·ã€‚

å­—æ®µè®¾è®¡ï¼š

- `id` BIGSERIAL PRIMARY KEY
- `symbol` TEXT  
  æ ‡çš„ä»£ç ï¼Œä¾‹å¦‚ `SH600000`ã€‚
- `as_of_time` TIMESTAMPTZ  
  ä¿¡å·è®¡ç®—æ—¶é—´æˆ³ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰ã€‚
- `frequency` TEXT  
  æ—¶é—´ç²’åº¦ï¼š`"5m"`, `"15m"`, `"1d"`, `"60m"` ç­‰ã€‚
- `horizon` TEXT  
  é¢„æµ‹çª—å£æ ‡è¯†ï¼šå¦‚ `"next_5m"`, `"next_3x5m"`, `"next_1d"`, `"next_3d"`ã€‚
- `direction` TEXT  
  `"up"` / `"down"` / `"flat"` / `"uncertain"`ã€‚
- `prob_up` DOUBLE PRECISION
- `prob_down` DOUBLE PRECISION
- `prob_flat` DOUBLE PRECISION
- `confidence` DOUBLE PRECISION  
  ç»¼åˆç½®ä¿¡åº¦ï¼ˆ0â€“1ï¼‰ã€‚
- `expected_return` NUMERIC(12,6)  
  æœŸæœ›ç›¸å¯¹æ”¶ç›Šï¼ˆå¯ä»¥æ˜¯ç™¾åˆ†æ¯”æˆ– bpï¼Œéœ€åœ¨ç³»ç»Ÿå†…ç»Ÿä¸€çº¦å®šï¼‰ã€‚
- `expected_volatility` NUMERIC(12,6)  
  é¢„æµ‹æ³¢åŠ¨ç‡ï¼ˆåŒæ ·æŒ‰çº¦å®šå•ä½ï¼‰ã€‚
- `risk_score` DOUBLE PRECISION  
  é£é™©è¯„åˆ†ï¼ˆ0â€“1ï¼‰ã€‚
- `regime` TEXT  
  HMM ç­‰æ¨¡å‹è¯†åˆ«çš„è¡Œæƒ…çŠ¶æ€ï¼ˆå¦‚ `"bull"`, `"bear"`, `"sideways"`, `"high_risk"`ï¼‰ã€‚
- `liquidity_label` TEXT  
  `"good"` / `"medium"` / `"poor"`ã€‚
- `microstructure_label` TEXT  
  å¦‚ `"buy_dominant"`, `"sell_dominant"`, `"neutral"`ã€‚
- `anomaly_flags` JSONB  
  å¼‚å¸¸æ ‡è®°æ•°ç»„æˆ–å¯¹è±¡ï¼Œå¦‚ `{"sudden_gap": true, "halt": false}`ã€‚
- `suggested_position_delta` NUMERIC(8,4)  
  å»ºè®®ä»“ä½å˜åŒ–æ¯”ä¾‹ï¼ˆ-1.0 ~ 1.0ï¼‰ã€‚
- `suggested_t0_action` TEXT  
  `"buy_on_dip"` / `"sell_on_rally"` / `"hold"` / `"avoid"` ç­‰ã€‚
- `model_votes` JSONB  
  å„æ¨¡å‹è´¡çŒ®ï¼Œå¦‚ï¼š
  ```json
  {
    "ARIMA": {"direction": "up", "weight": 0.2},
    "HMM": {"regime": "sideways_bull", "weight": 0.2},
    "LSTM": {"direction": "up", "prob_up": 0.7, "weight": 0.3},
    "DEEPAR": {"direction": "up", "expected_return": 0.015, "weight": 0.3}
  }
  ```
- `ensemble_method` TEXT  
  é›†æˆæ–¹å¼æè¿°ï¼ˆå¦‚ `"weighted_average"`, `"rule_based"`ï¼‰ã€‚
- `data_coverage` JSONB  
  æ•°æ®è¦†ç›–åŒºé—´ï¼Œå¦‚ `{ "from": "2020-01-01", "to": "2025-11-24" }`ã€‚
- `model_versions` JSONB  
  å„æ¨¡å‹ç‰ˆæœ¬å·ï¼Œå¦‚ `{ "LSTM_PER_STOCK": "v1.2.3", "DEEPAR_DAILY": "v0.9.1" }`ã€‚
- `quality_flags` JSONB  
  æ•°æ®/æ¨¡å‹è´¨é‡æ ‡è®°ï¼ˆç¼ºå¤±æ•°æ®ã€è®­ç»ƒè¿‡æ—§ç­‰ï¼‰ã€‚
- `created_at` TIMESTAMPTZ DEFAULT now()
- `updated_at` TIMESTAMPTZ DEFAULT now()

å»ºè®®ç´¢å¼•ï¼š

- å”¯ä¸€çº¦æŸï¼ˆå¯é€‰ï¼‰ï¼š`UNIQUE(symbol, as_of_time, frequency, horizon)`ï¼›
- æŸ¥è¯¢åŠ é€Ÿç´¢å¼•ï¼š`INDEX ON quant_unified_signal(symbol, as_of_time DESC)`ã€‚

### 8.2 æ—¶åºè¡Œæƒ…ä¸é«˜é¢‘èšåˆè¡¨ç»“æ„

#### 8.2.1 æ—¥ K è¡¨ `ts_daily_bars`

- æ—¶é—´åˆ—ï¼ˆTimescale æ—¶é—´ç»´åº¦ï¼‰ï¼š`trade_date DATE`ï¼›
- ç»´åº¦åˆ—ï¼š
  - `symbol` TEXTï¼›
- å€¼åˆ—ï¼š
  - `open` NUMERIC(12,4)
  - `high` NUMERIC(12,4)
  - `low` NUMERIC(12,4)
  - `close` NUMERIC(12,4)
  - `volume` BIGINT  
    æˆäº¤é‡ï¼ˆæ‰‹æˆ–è‚¡ï¼Œéœ€åœ¨ç³»ç»Ÿä¸­ç»Ÿä¸€çº¦å®šï¼‰ï¼›
  - `amount` NUMERIC(18,2)  
    æˆäº¤é¢ï¼ˆå…ƒï¼‰ï¼›
  - `adj_close` NUMERIC(12,4)  
    å‰å¤æƒæ”¶ç›˜ä»·ï¼›
  - `adj_factor` NUMERIC(12,6)  
    å¤æƒå› å­ï¼›
  - å…¶ä»–éœ€è¦çš„æ—¥çº§å­—æ®µï¼ˆå¦‚æ¢æ‰‹ç‡ã€æµé€šå¸‚å€¼ç­‰ï¼Œå¯æŒ‰éœ€æ‰©å±•ï¼‰ã€‚

ä¸»é”®/ç´¢å¼•å»ºè®®ï¼š

- Timescale hypertableï¼š`CREATE TABLE ts_daily_bars (trade_date DATE, symbol TEXT, ...); SELECT create_hypertable('ts_daily_bars', 'trade_date', chunk_time_interval => INTERVAL '30 days');`
- å¤åˆå”¯ä¸€ç´¢å¼•ï¼š`UNIQUE(symbol, trade_date)`ã€‚

#### 8.2.2 åˆ†é’Ÿ K è¡¨ `ts_minute_bars`

- æ—¶é—´åˆ—ï¼š`trade_time TIMESTAMPTZ`ï¼›
- ç»´åº¦åˆ—ï¼š
  - `symbol` TEXTï¼›
  - `freq` TEXT  
    å¦‚ `"1m"`, `"5m"`, `"15m"`, `"30m"`, `"60m"`ã€‚
- å€¼åˆ—ï¼š
  - `open` NUMERIC(12,4)
  - `high` NUMERIC(12,4)
  - `low` NUMERIC(12,4)
  - `close` NUMERIC(12,4)
  - `volume` BIGINT
  - `amount` NUMERIC(18,2)

ä¸»é”®/ç´¢å¼•å»ºè®®ï¼š

- hypertable on `trade_time`ï¼›
- å¤åˆå”¯ä¸€ç´¢å¼•ï¼š`UNIQUE(symbol, trade_time, freq)`ã€‚

#### 8.2.3 é«˜é¢‘èšåˆè¡¨ `ts_lstm_trade_agg`

- æ—¶é—´åˆ—ï¼š`bucket_start_time TIMESTAMPTZ`ï¼›
- ç»´åº¦åˆ—ï¼š
  - `symbol` TEXTï¼›
  - `freq` TEXTï¼ˆ`"5m"`/`"15m"`ï¼‰ã€‚
- å€¼åˆ—ï¼š
  - `buy_volume` BIGINT
  - `sell_volume` BIGINT
  - `neutral_volume` BIGINT
  - `order_flow_imbalance` DOUBLE PRECISION
  - `big_trade_volume` BIGINT
  - `big_trade_count` INTEGER
  - `big_trade_ratio` DOUBLE PRECISION
  - `realized_vol` DOUBLE PRECISION
  - `trade_count` INTEGER
  - `avg_trade_size` DOUBLE PRECISION
  - `intensity` DOUBLE PRECISION
  - `extra_json` JSONBï¼ˆé¢„ç•™æ‰©å±•å­—æ®µï¼‰ã€‚

ä¸»é”®/ç´¢å¼•å»ºè®®ï¼š

- hypertable on `bucket_start_time`ï¼›
- å”¯ä¸€ç´¢å¼•ï¼š`UNIQUE(symbol, bucket_start_time, freq)`ã€‚

#### 8.2.4 è‡ªé€‰æ± è¡¨ `app.watchlist_items`

> æœ¬è®¾è®¡ä¸æ–°å»ºæ–°çš„è‡ªé€‰è‚¡ç¥¨æ± è¡¨ï¼Œç›´æ¥å¤ç”¨ç°æœ‰çš„ `app.watchlist_items` ä½œä¸º LSTM CoreUniverse çš„æ¥æºï¼Œä»…åœ¨å…¶ä¸Šæ–°å¢é‡åŒ–ç›¸å…³å­—æ®µã€‚

- `id` BIGSERIAL PRIMARY KEY
- `code` TEXT NOT NULL UNIQUE  
  è‚¡ç¥¨ä»£ç ï¼Œä½¿ç”¨ ts_code è§„èŒƒï¼ˆä¸ TDX/analysis_records ä¸€è‡´ï¼‰ã€‚
- `name` TEXT NOT NULL  
  è‚¡ç¥¨åç§°ã€‚
- `note` TEXT NULL  
  å¤‡æ³¨ä¿¡æ¯ã€‚
- `join_price` NUMERIC(12,4) NULL  
  åŠ å…¥è‡ªé€‰æ± æ—¶ä» TDX æœ€æ–°è¡Œæƒ…è·å–çš„å‚è€ƒä»·æ ¼ï¼Œç”¨äºç•Œé¢å±•ç¤ºâ€œè‡ªåŠ å…¥ä»¥æ¥æ¶¨è·Œå¹…â€ï¼›
  å¯¹äºå†å²è®°å½•ï¼Œå°†é€šè¿‡â€œæ—¥ K æ”¶ç›˜ä»·å›å¡«è„šæœ¬â€è¡¥é½ï¼ˆè§ 9.10ï¼‰ã€‚
- `created_at` TIMESTAMPTZ NOT NULL DEFAULT now()
- `updated_at` TIMESTAMPTZ NOT NULL DEFAULT now()

è¯´æ˜ï¼š

- åˆ†ç±»ä¿¡æ¯ç»§ç»­ä½¿ç”¨å·²æœ‰çš„ `app.watchlist_categories` ä¸ `app.watchlist_item_categories` ä¸¤è¡¨ï¼Œä¸åšç»“æ„å˜æ›´ï¼›
- CoreUniverse çš„é€‰è‚¡èŒƒå›´ç”± `app.watchlist_items`ï¼ˆåŠå…¶åˆ†ç±»ï¼‰å†³å®šï¼Œæ— éœ€é¢å¤– Universe è¡¨ã€‚

#### 8.2.5 æ•°æ®åŒæ­¥æ—¥å¿—è¡¨ `data_sync_log`

- `id` BIGSERIAL PRIMARY KEY
- `data_type` TEXT  
  `"daily"` / `"minute"` / `"trade_agg"`ã€‚
- `symbol` TEXT NULL  
  è‹¥ä¸º `NULL` è¡¨ç¤ºå…¨å¸‚åœºæˆ–æŒ‰äº¤æ˜“æ‰€ç»´åº¦ï¼›
- `exchange` TEXT NULL  
  `"SH"` / `"SZ"` / `NULL`ï¼›
- `freq` TEXT NULL  
  åˆ†é’Ÿæ•°æ®ç²’åº¦ï¼›
- `last_full_sync_from` DATE/TIMESTAMPTZ NULL
- `last_full_sync_to` DATE/TIMESTAMPTZ NULL
- `last_incremental_sync_to` DATE/TIMESTAMPTZ NULL
- `status` TEXT  
  `"OK"` / `"ERROR"` ç­‰ï¼›
- `message` TEXT NULL
- `updated_at` TIMESTAMPTZ

ç”¨äºåœ¨æ•°æ®åŒæ­¥æœåŠ¡ä¸­æŸ¥è¯¢æ¯ä¸ªç»´åº¦æœ€è¿‘åŒæ­¥æƒ…å†µã€‚

### 8.3 æ¨¡å‹è®­ç»ƒç®¡ç†ç›¸å…³è¡¨ç»“æ„

#### 8.3.1 `model_config`

- `id` BIGSERIAL PRIMARY KEY
- `model_name` TEXT  
  ä¾‹å¦‚ï¼š`"LSTM_PER_STOCK"`, `"LSTM_SHARED"`, `"DEEPAR_DAILY"`, `"DEEPAR_60M"`ã€‚
- `description` TEXT
- `config_json` JSONB  
  åŒ…å«ï¼š
  - `universe_type`: `"core"` / `"shared"` / `"all"`ï¼›
  - `core_universe_max_size`: INTEGERï¼›
  - `deepar_filters`: å¯¹æˆäº¤é¢/ä¸Šå¸‚æ—¶é—´è¿‡æ»¤çš„å‚æ•°ï¼›
  - `data_granularity`: `"5m"` / `"15m"` / `"1d"` / `"60m"`ï¼›
  - `history_window_years`: FLOATï¼›
  - `train_schedule_cron`: TEXTï¼ˆcron è¡¨è¾¾å¼ï¼‰ï¼›
  - `time_budget_minutes`: INTEGERï¼›
  - å…¶å®ƒæ¨¡å‹ç›¸å…³è¶…å‚ã€è·¯å¾„é…ç½®ç­‰ã€‚
- `enabled` BOOLEAN DEFAULT TRUE
- `created_at`, `updated_at` TIMESTAMPTZ

#### 8.3.2 `model_train_run`

- `id` BIGSERIAL PRIMARY KEY
- `model_name` TEXT
- `config_snapshot` JSONB
- `status` TEXT  
  `"PENDING"`, `"RUNNING"`, `"SUCCESS"`, `"FAILED"`ã€‚
- `start_time` TIMESTAMPTZ
- `end_time` TIMESTAMPTZ NULL
- `duration_seconds` DOUBLE PRECISION NULL
- `symbols_covered_count` INTEGER
- `time_range_start` DATE/TIMESTAMPTZ
- `time_range_end` DATE/TIMESTAMPTZ
- `data_granularity` TEXT
- `metrics_json` JSONB NULL  
  å¦‚ `{ "train_loss": 0.01, "val_loss": 0.012, "val_rmse": 0.03 }`ã€‚
- `log_path` TEXT NULL

ç´¢å¼•ï¼š`INDEX ON model_train_run(model_name, start_time DESC)`ã€‚

#### 8.3.3 `model_inference_run`

- `id` BIGSERIAL PRIMARY KEY
- `model_name` TEXT
- `schedule_name` TEXT NULL  
  å¦‚ `"DAILY_CLOSE"`, `"INTRADAY_5M"`ã€‚
- `config_snapshot` JSONB
- `status` TEXT
- `start_time`, `end_time`, `duration_seconds`
- `symbols_covered` INTEGER
- `time_of_data` TIMESTAMPTZ  
  è¾“å…¥æ•°æ®çš„æˆªæ­¢æ—¶é—´ç‚¹ï¼›
- `metrics_json` JSONB NULL  
  å¯å­˜æ”¾å®æ—¶ç›‘æ§ç»Ÿè®¡ï¼ˆå¦‚é¢„æµ‹åˆ†å¸ƒç­‰ï¼‰ã€‚

### 8.4 æ¨¡å‹è®­ç»ƒä¸æ¨ç† API è®¾è®¡

#### 8.4.1 æ‰‹åŠ¨è§¦å‘è®­ç»ƒï¼š`POST /api/models/train`

- **æ–¹æ³•**ï¼šPOST
- **URL**ï¼š`/api/models/train`
- **è¯·æ±‚ JSONï¼ˆç¤ºä¾‹ï¼‰**ï¼š

```json
{
  "model_name": "LSTM_PER_STOCK",
  "symbols": ["SH600000", "SZ000001"],
  "time_range": {"start": "2020-01-01", "end": "2025-11-24"},
  "data_granularity": "5m",
  "force_full_train": false,
  "config_override": {
    "history_window_years": 3.0,
    "time_budget_minutes": 30
  }
}
```

- **ä¸»è¦å­—æ®µå«ä¹‰**ï¼š
  - `model_name`: å¿…å¡«ï¼Œè¦è®­ç»ƒçš„æ¨¡å‹æ ‡è¯†ï¼›
  - `symbols`: å¯é€‰ï¼Œè‹¥ä¸ºç©ºåˆ™ç”± `model_config` å†³å®š Universeï¼›
  - `time_range`: å¯é€‰ï¼Œç¼ºçœåˆ™æ ¹æ® `history_window_years` æ¨å¯¼ï¼›
  - `data_granularity`: 5m/15m/1d/60mï¼›
  - `force_full_train`: æ˜¯å¦å¿½ç•¥ç°æœ‰ checkpoint ä»å¤´è®­ç»ƒï¼›
  - `config_override`: å¯¹ `model_config` ä¸­æŸäº›å­—æ®µçš„è¦†ç›–ã€‚

- **å“åº” JSONï¼ˆç¤ºä¾‹ï¼‰**ï¼š

```json
{
  "run_id": 12345,
  "status": "PENDING"
}
```

#### 8.4.2 æ‰‹åŠ¨è§¦å‘æ¨ç†ï¼š`POST /api/models/inference`

- **æ–¹æ³•**ï¼šPOST
- **URL**ï¼š`/api/models/inference`
- **è¯·æ±‚ JSONï¼ˆç¤ºä¾‹ï¼‰**ï¼š

```json
{
  "model_name": "LSTM_PER_STOCK",
  "symbols": ["SH600000", "SZ000001"],
  "as_of_time": "2025-11-24T14:30:00+08:00",
  "frequencies": ["5m"],
  "horizons": ["next_5m", "next_3x5m"],
  "save_signals": true
}
```

- å­—æ®µè¯´æ˜ï¼š
  - `symbols`: æ¨ç†ç›®æ ‡è‚¡ç¥¨åˆ—è¡¨ï¼›
  - `as_of_time`: ä»¥å“ªä¸ªæ—¶é—´ç‚¹ä¸ºå‡†æ‹‰å–å†å²åºåˆ—ï¼›
  - `frequencies`: æ—¶é—´ç²’åº¦åˆ—è¡¨ï¼›
  - `horizons`: éœ€è¦è¾“å‡ºçš„é¢„æµ‹çª—å£åˆ—è¡¨ï¼›
  - `save_signals`: æ˜¯å¦å°† `UnifiedSignal` å†™å…¥ `quant_unified_signal`ã€‚

- **å“åº” JSONï¼ˆç¤ºä¾‹ï¼Œç›´æ¥è¿”å›ä¿¡å·ï¼‰**ï¼š

```json
{
  "run_id": 67890,
  "status": "SUCCESS",
  "signals": [
    {
      "symbol": "SH600000",
      "frequency": "5m",
      "horizon": "next_5m",
      "direction": "up",
      "prob_up": 0.72,
      "prob_down": 0.18,
      "prob_flat": 0.10,
      "expected_return": 0.003,
      "risk_score": 0.4
    }
  ]
}
```

ä¹Ÿå¯ä»¥åªè¿”å› `run_id`ï¼Œç”±å‰ç«¯è½®è¯¢è·å–ç»“æœï¼Œè§†å®ç°é€‰æ‹©ã€‚

#### 8.4.3 æŸ¥è¯¢æ¨¡å‹çŠ¶æ€ï¼š`GET /api/models/status`

- **æ–¹æ³•**ï¼šGET
- **URL**ï¼š`/api/models/status?model_name=LSTM_PER_STOCK`
- **å“åº” JSONï¼ˆç¤ºä¾‹ï¼‰**ï¼š

```json
{
  "models": [
    {
      "model_name": "LSTM_PER_STOCK",
      "enabled": true,
      "last_train_run": {
        "run_id": 12345,
        "status": "SUCCESS",
        "start_time": "2025-11-23T22:00:00+08:00",
        "end_time": "2025-11-23T23:10:00+08:00",
        "symbols_covered_count": 32,
        "time_range": {"start": "2022-01-01", "end": "2025-11-23"}
      }
    }
  ]
}
```

#### 8.4.4 æŸ¥è¯¢è®­ç»ƒ/æ¨ç†å†å²ï¼š`GET /api/models/runs`

- **æ–¹æ³•**ï¼šGET
- **URL**ï¼š`/api/models/runs?model_name=DEEPAR_DAILY&limit=50&offset=0&type=train`

å“åº”è¿”å›åˆ†é¡µåçš„ `model_train_run` æˆ– `model_inference_run` åˆ—è¡¨ã€‚

### 8.5 æ•°æ®åŒæ­¥ API è®¾è®¡

#### 8.5.1 è§¦å‘åŒæ­¥ï¼š`POST /api/data-sync/run`

- **æ–¹æ³•**ï¼šPOST
- **URL**ï¼š`/api/data-sync/run`
- **è¯·æ±‚ JSON**ï¼š

```json
{
  "data_type": "minute",
  "symbols": ["SH600000", "SZ000001"],
  "exchange": null,
  "freq": "5m",
  "start_date": "2020-01-01",
  "end_date": "2025-11-24",
  "mode": "init"
}
```

- å­—æ®µå«ä¹‰åŒç¬¬ 6 ç« ä¸­çš„å‚æ•°è¯´æ˜ã€‚

#### 8.5.2 æŸ¥è¯¢åŒæ­¥çŠ¶æ€ï¼š`GET /api/data-sync/status`

- **æ–¹æ³•**ï¼šGET
- **URL**ï¼š`/api/data-sync/status?data_type=daily&symbol=SH600000`
- å“åº”å†…å®¹æ¥è‡ª `data_sync_log`ï¼ŒåŒ…å«æœ€è¿‘åŒæ­¥çš„æ—¶é—´èŒƒå›´ä¸çŠ¶æ€ã€‚

### 8.6 Quant Analyst APIï¼ˆå¯¹ä¸Šå±‚åˆ†ææœåŠ¡ï¼‰

#### 8.6.1 è°ƒç”¨é‡åŒ–åˆ†æå¸ˆï¼š`POST /api/quant/signals`

- **æ–¹æ³•**ï¼šPOST
- **URL**ï¼š`/api/quant/signals`
- **è¯·æ±‚ JSONï¼ˆç¤ºä¾‹ï¼‰**ï¼š

```json
{
  "symbol": "SH600000",
  "as_of_time": "2025-11-24T14:30:00+08:00",
  "horizons": ["next_5m", "next_15m", "next_1d"],
  "frequencies": ["5m", "1d"],
  "data_scope": {
    "intraday_history_days": 60,
    "daily_history_years": 3,
    "need_high_freq_features": true
  },
  "use_models": ["ARIMA", "HMM", "LSTM", "DEEPAR"],
  "include_raw_model_outputs": true
}
```

- **å“åº” JSONï¼ˆç¤ºä¾‹ï¼‰**ï¼š

```json
{
  "symbol": "SH600000",
  "as_of_time": "2025-11-24T14:30:00+08:00",
  "signals": [
    {
      "frequency": "5m",
      "horizon": "next_5m",
      "direction": "up",
      "prob_up": 0.72,
      "prob_down": 0.18,
      "prob_flat": 0.10,
      "expected_return": 0.003,
      "risk_score": 0.4,
      "regime": "sideways_bull"
    }
  ],
  "raw_model_outputs": {
    "ARIMA": {"...": "..."},
    "HMM": {"...": "..."},
    "LSTM": {"...": "..."},
    "DEEPAR": {"...": "..."}
  }
}
```

ä¸Šå±‚èµ„é‡‘/åŸºæœ¬é¢/é£é™©åˆ†æå¸ˆå¯ç›´æ¥åŸºäºè¯¥ API çš„è¾“å‡ºè¿›è¡Œå¾®è°ƒä¸è§£é‡Šã€‚

---

## 9. æ ¸å¿ƒæµç¨‹ä¼ªä»£ç 

æœ¬ç« ä»¥ä¼ªä»£ç å½¢å¼æè¿°å…³é”®æµç¨‹ï¼šæ•°æ®åŒæ­¥ã€ç‰¹å¾æ„å»ºã€LSTM/DeepAR è®­ç»ƒä¸æ¨ç†ã€Signal é€‚é…ä¸è°ƒåº¦å™¨é›†æˆï¼Œä¾¿äºåç»­ç›´æ¥ç¿»è¯‘ä¸ºå…·ä½“å®ç°ä»£ç ã€‚

> ä¼ªä»£ç é£æ ¼æ¥è¿‘ Pythonï¼Œä½†ä¸ä¾èµ–å…·ä½“æ¡†æ¶ï¼Œä»…è¡¨è¾¾è¿‡ç¨‹é€»è¾‘å’Œæ•°æ®æµã€‚

### 9.1 æ—¥ K æ•°æ®å…¨é‡/å¢é‡åŒæ­¥

```python
def sync_daily_bars(data_type: str, symbols: list[str] | None, exchange: str | None,
                    start_date: date, end_date: date, mode: str):
    # data_type åº”ä¸º "daily"
    assert data_type == "daily"

    target_symbols = resolve_symbols(symbols, exchange)

    for symbol in target_symbols:
        last_sync = query_data_sync_log("daily", symbol)

        if mode == "incremental" and last_sync.last_incremental_sync_to is not None:
            effective_start = max(start_date, last_sync.last_incremental_sync_to + 1 day)
        else:
            effective_start = start_date

        if effective_start > end_date:
            continue

        # è°ƒç”¨ TDX API æ‹‰å–æ—¥ K
        kline_data = tdx_client.get_kline_daily(symbol, effective_start, end_date)

        # æ‰¹é‡ upsert åˆ° ts_daily_bars
        upsert_ts_daily_bars(symbol, kline_data)

        # æ›´æ–° data_sync_log
        update_data_sync_log(
            data_type="daily",
            symbol=symbol,
            last_full_sync_from=(None if mode == "incremental" else start_date),
            last_full_sync_to=(None if mode == "incremental" else end_date),
            last_incremental_sync_to=end_date,
            status="OK",
        )
```

### 9.2 åˆ†é’Ÿ K ä¸é«˜é¢‘èšåˆæ•°æ®åŒæ­¥

```python
def sync_minute_bars(symbols: list[str], freq: str, start_dt: datetime,
                     end_dt: datetime, mode: str):
    for symbol in symbols:
        last_sync = query_data_sync_log("minute", symbol, freq=freq)

        effective_start = compute_effective_start(last_sync, start_dt, mode)
        if effective_start >= end_dt:
            continue

        minute_data = tdx_client.get_kline_minute(symbol, freq, effective_start, end_dt)
        upsert_ts_minute_bars(symbol, freq, minute_data)

        update_data_sync_log("minute", symbol, freq=freq,
                             last_incremental_sync_to=end_dt, status="OK")


def sync_trade_agg(symbols: list[str], freq: str, start_dt: datetime, end_dt: datetime):
    for symbol in symbols:
        # æ‹‰å–é€ç¬”æˆäº¤
        trades = tdx_client.get_trades(symbol, start_dt, end_dt)

        # æŒ‰ freq åˆ†æ¡¶ï¼Œä¾‹å¦‚ 5m/15m
        buckets = bucketize_trades(trades, freq)

        agg_rows = []
        for bucket in buckets:
            features = compute_trade_agg_features(bucket)
            agg_rows.append(features)

        upsert_ts_lstm_trade_agg(symbol, freq, agg_rows)
```

`compute_trade_agg_features` æŒ‰ç¬¬ 4 ç« çš„å››ç±»ç‰¹å¾è¿›è¡Œè®¡ç®—ã€‚

### 9.3 LSTM æ•°æ®é›†æ„å»º

```python
def build_lstm_dataset_for_symbol(symbol: str, freq: str,
                                  history_years: float,
                                  lookback: int) -> Dataset:
    end_time = now()
    start_time = end_time - years(history_years)

    minute_bars = query_ts_minute_bars(symbol, freq, start_time, end_time)
    trade_agg = query_ts_lstm_trade_agg(symbol, freq, start_time, end_time)

    # å¯¹é½æ—¶é—´è½´å¹¶ join ç‰¹å¾
    aligned = align_and_join(minute_bars, trade_agg)

    X, y = [], []
    for idx in range(lookback, len(aligned)):
        window = aligned[idx - lookback : idx]
        target = compute_target(aligned, idx)  # å¦‚ä¸‹ä¸€ bar çš„æ”¶ç›Š/æ–¹å‘
        X.append(extract_features(window))
        y.append(target)

    return Dataset(X, y)
```

### 9.4 LSTM è®­ç»ƒæµç¨‹ï¼ˆper-stock / sharedï¼‰

```python
def train_lstm_per_stock(config: LSTMConfig):
    symbols = load_core_universe(config)
    for symbol in symbols:
        dataset = build_lstm_dataset_for_symbol(
            symbol=symbol,
            freq=config.freq,
            history_years=config.history_window_years,
            lookback=config.lookback,
        )

        model = LSTMModel(config)
        history = model.train(dataset, time_budget_minutes=config.time_budget_minutes)

        save_model_weights(model, name=f"LSTM_{symbol}_{config.freq}")
        log_train_run("LSTM_PER_STOCK", symbol, config, history)


def train_lstm_shared(config: LSTMConfig):
    symbols = load_shared_universe(config)
    datasets = [build_lstm_dataset_for_symbol(s, config.freq,
                                             config.history_window_years,
                                             config.lookback)
                for s in symbols]

    merged_dataset = merge_datasets_with_symbol_id(datasets)

    model = LSTMModel(config, shared=True)
    history = model.train(merged_dataset, time_budget_minutes=config.time_budget_minutes)

    save_model_weights(model, name=f"LSTM_SHARED_{config.freq}")
    log_train_run("LSTM_SHARED", None, config, history)
```

### 9.5 LSTM æ¨ç†æµç¨‹

```python
def infer_lstm_for_symbol(symbol: str, as_of_time: datetime,
                          freq: str, horizons: list[str]) -> LSTMOutput:
    model = load_best_available_lstm_model(symbol, freq)

    # æ‹‰å–æœ€è¿‘ lookback ä¸ªæ—¶é—´æ­¥çš„ç‰¹å¾
    history_window = query_recent_features(symbol, freq, as_of_time, lookback=model.lookback)

    features = build_input_tensor(history_window)
    raw_pred = model.predict(features)

    # å°†åŸå§‹è¾“å‡ºè½¬æ¢ä¸ºç»“æ„åŒ–çš„ LSTMOutput
    return parse_lstm_raw_prediction(raw_pred, horizons)
```

### 9.6 DeepAR è®­ç»ƒä¸æ¨ç†æµç¨‹

```python
def build_deepar_dataset(config: DeepARConfig) -> Dataset:
    universe = filter_universe_by_rules(
        all_symbols=get_all_symbols(),
        min_avg_turnover=config.min_avg_turnover,
        min_listed_months=config.min_listed_months,
        exclude_st=True,
        exclude_delisted=True,
        exclude_beijing_exchange=True,
    )

    series_list = []
    for symbol in universe:
        daily_bars = query_ts_daily_bars(symbol, config.history_window_years)
        hf_factors = query_intraday_factors(symbol, config.history_window_years)
        merged = join_daily_with_factors(daily_bars, hf_factors)
        series_list.append(merged)

    return DeepARDataset(series_list)


def train_deepar_daily(config: DeepARConfig):
    dataset = build_deepar_dataset(config)
    model = DeepARModel(config)
    history = model.train(dataset, time_budget_hours=config.time_budget_hours)

    save_model_weights(model, name="DEEPAR_DAILY")
    log_train_run("DEEPAR_DAILY", None, config, history)


def infer_deepar_for_symbol(symbol: str, as_of_date: date,
                            horizons: list[str]) -> DeepAROutput:
    model = load_model("DEEPAR_DAILY")
    series = load_single_symbol_series(symbol)
    context = get_history_until(series, as_of_date)

    forecast_dist = model.forecast(context, prediction_length=len(horizons))
    return build_deepar_output_from_dist(forecast_dist, horizons)
```

### 9.7 UnifiedSignal é€‚é…ä¸é›†æˆ

```python
def build_unified_signal(symbol: str, as_of_time: datetime,
                         freq: str, horizon: str,
                         arima_out: ARIMAOutput | None,
                         hmm_out: HMMOutput | None,
                         lstm_out: LSTMOutput | None,
                         deepar_out: DeepAROutput | None) -> UnifiedSignal:

    # æ–¹å‘ä¸æ¦‚ç‡åˆå§‹å€¼
    direction, prob_up, prob_down, prob_flat = aggregate_direction(
        arima_out, lstm_out, deepar_out
    )

    # æœŸæœ›æ”¶ç›Š/æ³¢åŠ¨
    expected_return, expected_vol = aggregate_return_vol(
        arima_out, lstm_out, deepar_out
    )

    # çŠ¶æ€ä¸é£é™©
    regime, risk_score = extract_regime_and_risk(hmm_out, deepar_out)

    # ç»„è£… model_votes
    model_votes = build_model_votes(arima_out, hmm_out, lstm_out, deepar_out)

    return UnifiedSignal(
        symbol=symbol,
        as_of_time=as_of_time,
        frequency=freq,
        horizon=horizon,
        direction=direction,
        prob_up=prob_up,
        prob_down=prob_down,
        prob_flat=prob_flat,
        expected_return=expected_return,
        expected_volatility=expected_vol,
        risk_score=risk_score,
        regime=regime,
        model_votes=model_votes,
        # å…¶ä½™å­—æ®µç”±åç»­è§„åˆ™/åˆ†æå¸ˆå¡«å……
    )
```

### 9.8 è°ƒåº¦å™¨ä¸»å¾ªç¯ï¼ˆè®­ç»ƒ + æ¨ç† + æ•°æ®åŒæ­¥ï¼‰

```python
def setup_schedulers():
    scheduler = APScheduler()

    # æ—¥ K å¢é‡åŒæ­¥ï¼ˆæ”¶ç›˜åï¼‰
    scheduler.add_job(sync_daily_bars_job, trigger="cron", hour=16, minute=30)

    # åˆ†é’Ÿ K + é«˜é¢‘èšåˆï¼ˆç›˜ä¸­ï¼‰
    scheduler.add_job(sync_minute_and_trade_agg_job,
                      trigger="cron", minute="*/5")

    # å‘¨åº¦ LSTM è®­ç»ƒ
    scheduler.add_job(train_lstm_weekly_job, trigger="cron", day_of_week="sat", hour=1)

    # åŒå‘¨ DeepAR è®­ç»ƒ
    scheduler.add_job(train_deepar_biweekly_job,
                      trigger="cron", week="*/2", day_of_week="sun", hour=1)

    # æ—¥å†…æ¨ç†ï¼ˆ5/15 åˆ†é’Ÿï¼‰
    scheduler.add_job(infer_intraday_signals_job,
                      trigger="cron", minute="*/5")

    scheduler.start()
```

### 9.9 Quant Analyst ç«¯åˆ°ç«¯æµç¨‹

```python
def run_quant_analyst(request: QuantAnalystInput) -> QuantAnalystOutput:
    # 1. æ•°æ®å‡†å¤‡ï¼šä» TimescaleDB è¯»å–å†å² + å¿…è¦æ—¶ TDX è¡¥é½æœ€æ–°
    data_bundle = load_data_for_quant(request)

    # 2. è°ƒç”¨å„æ¨¡å‹
    arima_out = run_arima_if_enabled(request, data_bundle)
    hmm_out = run_hmm_if_enabled(request, data_bundle)
    lstm_out = run_lstm_if_enabled(request, data_bundle)
    deepar_out = run_deepar_if_enabled(request, data_bundle)

    # 3. æ„å»ºç»Ÿä¸€ä¿¡å·åˆ—è¡¨
    signals = []
    for freq in request.frequencies:
        for horizon in request.horizons:
            sig = build_unified_signal(
                symbol=request.symbol,
                as_of_time=request.as_of_time,
                freq=freq,
                horizon=horizon,
                arima_out=arima_out,
                hmm_out=hmm_out,
                lstm_out=lstm_out,
                deepar_out=deepar_out,
            )
            signals.append(sig)

    raw_outputs = {
        "ARIMA": arima_out,
        "HMM": hmm_out,
        "LSTM": lstm_out,
        "DEEPAR": deepar_out,
    }

    return QuantAnalystOutput(symbol=request.symbol,
                              as_of_time=request.as_of_time,
                              signals=signals,
                              raw_model_outputs=raw_outputs)

### 9.10 ARIMA ä¸ HMM å®ç°ä¸å¯¹æ¥è§„åˆ’

æœ¬èŠ‚åœ¨å‰æ–‡å¯¹ ARIMA/HMM è§’è‰²çš„æè¿°åŸºç¡€ä¸Šï¼Œç»™å‡ºåœ¨æ–°ç¨‹åºä¸­çš„å…·ä½“å®ç°ä¸å¯¹æ¥æ–¹æ¡ˆï¼Œä¾›åç»­å¼€å‘ä¸¥æ ¼éµå¾ªã€‚

#### 9.10.1 æ¨¡å—åˆ’åˆ†ä¸è·¯å¾„

- åœ¨ `backend/quant_models` ä¸‹æ–°å¢ä¸¤ä¸ªå­åŒ…ï¼š
  - `backend/quant_models/arima/`
    - `train.py`ï¼šARIMA è®­ç»ƒè„šæœ¬ï¼ˆæ”¯æŒæ‰¹é‡æ ‡çš„ï¼‰ï¼Œè®°å½•åˆ° `app.model_train_run`ï¼›
    - `infer.py`ï¼šARIMA æ¨ç†è„šæœ¬ä¸å¯å¤ç”¨å‡½æ•°ï¼ˆå•æ ‡çš„/æ‰¹é‡ï¼‰ï¼Œè®°å½•åˆ° `app.model_inference_run`ï¼›
  - `backend/quant_models/hmm/`
    - `train.py`ï¼šHMM è®­ç»ƒè„šæœ¬ï¼ˆå…±äº«æ¨¡å‹ï¼‰ï¼Œè®°å½•åˆ° `app.model_train_run`ï¼›
    - `infer.py`ï¼šHMM æ¨ç†è„šæœ¬ä¸å¯å¤ç”¨å‡½æ•°ï¼ˆå•æ ‡çš„/æ‰¹é‡ï¼‰ï¼Œè®°å½•åˆ° `app.model_inference_run`ã€‚

ä¸Šè¿°è„šæœ¬é£æ ¼ä¸ç°æœ‰ `lstm` / `deepar` æ¨¡å—ä¿æŒä¸€è‡´ï¼š

- CLI å±‚è´Ÿè´£ï¼š
  - ä» `app.model_config` / `app.model_schedule` è¯»å–é…ç½®ï¼›
  - å¾ªç¯è°ƒç”¨åº•å±‚æ¨ç†/è®­ç»ƒå‡½æ•°ï¼›
  - å°†è¿è¡Œç»“æœå†™å…¥ `app.model_train_run` / `app.model_inference_run`ï¼›
- åº•å±‚å‡½æ•°å±‚è´Ÿè´£ï¼š
  - åªæ¥æ”¶ `ts_code`ã€`as_of_time`ã€ç‰¹å¾ DataFrame ä¸é…ç½®å¯¹è±¡ï¼Œè¿”å›ç»“æ„åŒ–è¾“å‡ºï¼›
  - ä¸ç›´æ¥å†™ DBï¼Œä¹Ÿä¸ä¾èµ– CLI å‚æ•°è§£æã€‚

#### 9.10.2 ç»“æ„åŒ–è¾“å‡ºç±»å‹

åœ¨ `backend/services/quant_analyst_service.py` ä¸­å®šä¹‰å¹¶ç»Ÿä¸€ä½¿ç”¨ä»¥ä¸‹è¾“å‡ºæ¨¡å‹ï¼ˆPydanticï¼‰ï¼š

- `ARIMAOutput`ï¼š
  - å­—æ®µï¼š`symbol`, `as_of_time`, `freq`, `forecasts: List[ARIMAHorizonForecast]`, `meta`ï¼›
  - `ARIMAHorizonForecast`ï¼š`horizon`, `expected_return`, `direction`ï¼›
- `HMMOutput`ï¼š
  - å­—æ®µï¼š`symbol`, `as_of_time`, `freq`, `regime`, `regime_probabilities: Dict[str,float]`, `meta`ã€‚

åç»­ ARIMA/HMM æ¨ç†å‡½æ•°å¿…é¡»è¿”å›ä¸Šè¿°ç»“æ„ç±»å‹ï¼Œä»¥ä¾¿ Quant Analyst ä¸ `UnifiedSignal` é€‚é…å±‚ä»¥å¼ºç±»å‹æ–¹å¼æ¶ˆè´¹ç»“æœã€‚

#### 9.10.3 è®­ç»ƒä¸æ¨ç†æ•°æ®æ¥æº

- ARIMAï¼š
  - ä¸»æ•°æ®æºï¼š`market.kline_daily_qfq`ï¼ˆæˆ– rawï¼‰ï¼Œä¹Ÿå¯é€šè¿‡ `quant_datasets.deepar_dataset.load_deepar_daily_for_symbol` è·å–æ ‡å‡†åŒ–æ—¥çº§åºåˆ—ï¼›
  - è®­ç»ƒçª—å£ï¼šç”± `ARIMAConfig.history_days` æˆ– `history_years` æ§åˆ¶ï¼Œé»˜è®¤ 2â€“3 å¹´ï¼›
  - è¾“å‡ºï¼šé¢å‘è‹¥å¹² horizonï¼ˆå¦‚ `next_1d`, `next_3d`ï¼‰çš„æœŸæœ›ç›¸å¯¹æ”¶ç›Šé¢„æµ‹ï¼Œä½œä¸ºåŸºçº¿æ¨¡å‹ã€‚

- HMMï¼š
  - ä¸»æ•°æ®æºï¼šæ—¥çº§æ”¶ç›Šåºåˆ—ï¼ˆå¯é€‰åœ°åŠ å…¥æˆäº¤é‡/æ³¢åŠ¨ç‡ç­‰è§‚æµ‹å˜é‡ï¼‰ï¼Œå¯åŒæ ·åŸºäº `kline_daily_qfq` æ„å»ºï¼›
  - è®­ç»ƒæ–¹å¼ï¼šä»¥å…±äº«æ¨¡å‹å½¢å¼åœ¨è¿‡æ»¤åçš„ Universe ä¸Šè®­ç»ƒï¼ˆçŠ¶æ€æ•° 3â€“4 ä¸ªï¼Œæ¯”å¦‚ bull/bear/sideways/high_riskï¼‰ï¼›
  - è¾“å‡ºï¼šå½“å‰ `as_of_time` çš„æœ€å¯èƒ½ regime åŠ regime æ¦‚ç‡åˆ†å¸ƒã€‚

#### 9.10.4 ä¸ Quant Analyst çš„å‡½æ•°æ¥å£

åœ¨ `quant_analyst_service` ä¸­ï¼ŒQuant Analyst ä¸ç›´æ¥è°ƒç”¨ CLIï¼Œè€Œæ˜¯åªé€šè¿‡å‡½æ•°æ¥å£ä½¿ç”¨ ARIMA/HMMï¼š

- `run_arima_if_enabled(request, data_bundle) -> Optional[ARIMAOutput]`
  - ä» `data_bundle` ä¸­è¯»å–æ‰€éœ€æ—¥çº§åºåˆ—ï¼ˆä¾‹å¦‚ `deepar_daily`ï¼‰ï¼›
  - åŸºäº `model_config` æˆ–é»˜è®¤å‚æ•°æ„é€  `ARIMAConfig`ï¼›
  - è°ƒç”¨ `backend.quant_models.arima.infer.infer_arima_for_symbol`ï¼›
  - è‹¥ `request.use_models` æœªåŒ…å« `"ARIMA"`ï¼Œåˆ™è¿”å› `None`ï¼›
  - å¦åˆ™è¿”å› `ARIMAOutput`ã€‚

- `run_hmm_if_enabled(request, data_bundle) -> Optional[HMMOutput]`
  - ä» `data_bundle` ä¸­è¯»å–æ—¥çº§æˆ–æ›´ç»†ç²’åº¦æ”¶ç›Šåºåˆ—ï¼›
  - åŸºäº `model_config` æ„é€  `HMMConfig`ï¼›
  - è°ƒç”¨ `backend.quant_models.hmm.infer.infer_hmm_for_symbol`ï¼›
  - è‹¥ `use_models` æœªåŒ…å« `"HMM"`ï¼Œåˆ™è¿”å› `None`ï¼›å¦åˆ™è¿”å› `HMMOutput`ã€‚

åœ¨ `build_unified_signal` ä¸­ï¼š

- ä½¿ç”¨ `ARIMAOutput.forecasts` å‚ä¸æ–¹å‘ä¸ `expected_return` çš„é›†æˆï¼›
- ä½¿ç”¨ `HMMOutput.regime` / `regime_probabilities` ä¸º `UnifiedSignal.regime` ä¸é£é™©è¯„åˆ†æä¾›è¾“å…¥ï¼Œå¹¶å†™å…¥ `model_votes["HMM"]`ï¼›
- ä¸åœ¨ ARIMA/HMM å±‚ç›´æ¥å†™ `quant_unified_signal`ï¼Œæ‰€æœ‰æœ€ç»ˆä¿¡å·å†™å…¥ç»Ÿä¸€ç”± Quant Analyst å®Œæˆï¼Œé¿å…å¤šè·¯å¾„å†²çªã€‚

#### 9.10.5 ä¸è°ƒåº¦å™¨å’Œæ§åˆ¶è¡¨çš„é›†æˆ

- åœ¨ `app.model_config` ä¸­ä¸º ARIMA/HMM å¢åŠ æ¨¡å‹é…ç½®è®°å½•ï¼š
  - æ¨¡å‹åç¤ºä¾‹ï¼š`ARIMA_DAILY`, `HMM_DAILY`ï¼›
  - `config_json` ä¸­åŒ…å«ï¼šå†å²çª—å£é•¿åº¦ã€çŠ¶æ€æ•°ï¼ˆHMMï¼‰ã€Universe è¿‡æ»¤è§„åˆ™ç­‰ï¼›
- åœ¨ `app.model_schedule` ä¸­ä¸º ARIMA/HMM å¢åŠ è®­ç»ƒ/æ¨ç†è°ƒåº¦ï¼š
  - kind ç¤ºä¾‹ï¼š`"arima_train"`, `"arima_infer"`, `"hmm_train"`, `"hmm_infer"`ï¼›
  - ä¸ `backend/model_scheduler/scheduler.py` çš„ `DISPATCH_TABLE` ä¿æŒä¸€ä¸€å¯¹åº”ï¼›
- scheduler é€šè¿‡ CLI å…¥å£è°ƒç”¨ `backend.quant_models.arima.train` / `backend.quant_models.arima.infer` ç­‰ï¼Œ
  å¹¶å°† run ç»“æœè®°å½•åœ¨ `app.model_train_run` / `app.model_inference_run` ä¸­ã€‚

> å®æ–½é¡ºåºå»ºè®®ï¼šå…ˆåœ¨ `quant_analyst_service` ä¸­ä¿æŒ `run_arima_if_enabled` / `run_hmm_if_enabled`
> ç»§ç»­æŠ›å‡º `NotImplementedError`ï¼Œåœ¨å®Œæˆ ARIMA/HMM çš„è®­ç»ƒä¸æ¨ç†æ¨¡å—ã€å¹¶åœ¨æ–°ç¯å¢ƒä¸­é€šè¿‡å›æµ‹éªŒè¯åï¼Œ
> å†å°† Quant Analyst ä¸ ARIMA/HMM çš„é›†æˆå¼€å…³é€æ­¥æ‰“å¼€ï¼Œé¿å…å¼•å…¥æœªéªŒè¯çš„ä¿¡å·.
